{% extends 'base.html' %}
{% load static %}
{% block head %}
  <title>View Reservations</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
  <script type="text/javascript">
  top.visible_div_id = 'right';
  function toggle_visibility(id) {
     var old_e = document.getElementById(top.visible_div_id);
     var new_e = document.getElementById(id);
     if(old_e) {
        console.log('old', old_e, 'none');
        old_e.style.display = 'none';
     }
    console.log('new', new_e, 'block');
     new_e.style.display = 'block';
     top.visible_div_id = id;
  }
  </script>
  <script>
function leftFun(){
  document.getElementById("left_toggle_btn").classList.add('clicked_btn');

  document.getElementById("left_toggle_btn").classList.remove('not_clicked_btn');
   document.getElementById("right_toggle_btn").classList.remove('clicked_btn');

  document.getElementById("right_toggle_btn").classList.add('not_clicked_btn');
   }
function rightFun(){
  document.getElementById("right_toggle_btn").classList.add('clicked_btn');

  document.getElementById("right_toggle_btn").classList.remove('not_clicked_btn');
   document.getElementById("left_toggle_btn").classList.remove('clicked_btn');

  document.getElementById("left_toggle_btn").classList.add('not_clicked_btn');

}

function editDetails(elem){
{

        //var ID = $(this).parent().parent().attr('id');
        //var ID = elem.parentNode.id.slice(5);
        //var e = document.getElementById(ID);
      //  e.classList.add( "canceledElem");

       /////  $(e).find("button").prop("disabled", true);




}


}
</script>

<script>
$(document).ready(function(){
    $('[data-toggle="popover"]').popover();
});
</script>



<script type="text/javascript">
  //------------------------------------------------------------------------
  var reser;
  $(document).ready(function(){
  $(".myBtnEdit").click(function(){
    $("#myEditModal").modal();
      reser=this.name;
      $('#currentpickuptime').text($('#stt'+reser).text());
      $('#currentdropofftime').text($('#ent'+reser).text());
      $('#currentcost').text($('#cos'+reser).text());
      $('#currentstartstation').text($('#st'+reser).text());
      $('#currentendstation').text($('#en'+reser).text());
      var select = $('#currentstarttime');
      select.empty().append($('<option disabled selected value>'+'Change pick up time'+'</option>'));
      select.append($('<option></option>')
          .attr('value', 6)
          .text(':'+' ' ));
      select.append($('<option></option>')
              .attr('value', 5)
              .text('dfgdf:'+' ' ));
      //Disable end time
      document.getElementById('currentendtime').selectedIndex=0;
      document.getElementById('currentendtime').style.color= "grey" ;
      document.getElementById('currentendtime').disabled = true;

      //Disable confirm
      document.getElementById('myBtnSubmitChanges').style.display="none";
        });
});
//--------------------------------------------------------------
</script>


<script type="text/javascript">
  $(document).ready(function(){
  $("#myBtnCancel").click(function(){
   var ID = $(this).parent().parent().attr('id');


     $("#myCancelationModal .modal-body ").attr( "id", "modal"+ID);

     $("#myCancelationModal").modal();

  });
});
</script>

<script type="text/javascript">
  $(document).ready(function(){
  $("#myBtnFeedback").click(function(){
   var ID = $(this).parent().parent().attr('id');


     $("#myFeedbackModal .modal-body ").attr( "id", "modal"+ID);

     $("#myFeedbackModal").modal();

  });
});
</script>

<script type="text/javascript">


  function cancelReservation(elem){

        //var ID = $(this).parent().parent().attr('id');
        var ID = elem.parentNode.id.slice(5);
        var e = document.getElementById(ID);
        e.classList.add( "canceledElem");

         $(e).find("button").prop("disabled", true);
}

  function sendFeedback(elem){

        //var ID = $(this).parent().parent().attr('id');
        var ID = elem.parentNode.parentNode.id.slice(5);
        var e = document.getElementById(ID);
        var btn = $(e).find("button");
         $(btn).prop("disabled", true);
         $(btn).html("Feedback sent");
       }

</script>
<script type="text/javascript">
  $(document).ready(function(){
  $("#myBtnSubmitChanges").click(function(){
    $("#myInformationModal").modal();
  });
});
</script>


  <style>
  table{
    border-radius:6px;
    table-layout: fixed
  }
  .clicked_btn{
    background: rgba(0, 179, 179, 0.8);
    color: white;

  }
  .not_clicked_btn{
    background: rgba(0, 179, 179, 0.3);
     transition: 0.3s;
      color: white;

  }

  .toggle_btn{
     border-bottom: solid white 2px;
     width:100%;
     border-top-left-radius: 15px;
     border-top-right-radius: 15px;

  }
  .not_clicked_btn:hover{
    background:white;
    opacity: 1;
    color:black;
  }
  .toggle_btn:active{
      background:rgba(57, 161, 252, 0.2);
       color:black;

  }
  .alert{
    position: absolute; top: 70px; left: 10px; z-index: 99;right:10px;
  }
  .footer{
    height:80px;
    background-color:#3d3a3a;
    z-index: 5;
    position: absolute;
    bottom: 0;
    width: 100%;
    margin: 0 auto;
    display: none;
    padding:15px;
    display:none;
    border-top-left-radius:5px;
    border-top-right-radius:5px;
  }
  .footer-4{
    height:100%;
    width:100%;
    background-color:#3d3a3a;
    display:flex;
  }
  * {
  box-sizing: border-box
  }


  .i {
    float: right;
    border: 1px solid #ddd;
    border-radius: 7px;
    padding: 2px;
    width: 150px;
  }
  .closed{
  width:5%;
  height:100%;
  float:left;
  }

  .bod,.header,.dia,.modal-content
  {
    background-color: #3d3a3a;
    color: #3dcacd;
    border-radius:5px;
  }
  .tit{
    font-size: 15px;
    font-weight:bold;
    border-bottom:2px solid;
    border-top:2px solid;
    margin-bottom:4px;
  }
  .modal-content{
    display:flex;
  }
  .column-4, .column-8 {
    float: left;
    position: relative;

  }
  .column-4 {
    width: 33%;
    border: 1px solid;
    border-radius:10px;
  }
  .column-8 {
    width: 70%;
    text-align:right;

  }
  .column-1 {
    height: 20%;
    width:100%;
    float: left;
    position: relative;
  }
  .col1 {
    height: 80%;
    float: left;
    width:20%;
    position: relative;
  }
  .col2 {
    height: 50%;
    width:70%;
    float: right;
    position: relative;
  }
  .column-2 {
    width:100%;
    height: 80%;
    float: right;
    position: relative;
  }
  .start,.end{
    border:1px solid;
    text-align:center;
    border-radius:5px;
    font-size:12px;
  }
  .start{
    border:1px solid #7CFC00;
    color:	#7CFC00;
    margin-bottom:2px;
  }
  .end{
    border:1px solid #f44336;
    color: #f44336;
    border-color:red;
  }
  .priority{
    font-size:10px;
  }
  .list-group-item{
    background-color: #3d3a3a;
    border-style:none!important;
    color:black;
  }
  .information
  {
    font-weight:bold;
    font-size:12px;
  }
  .styled-select select {
  background: transparent;
  border: none;
  font-size: 14px;
  height: 29px;
  padding: 15px; /* If you add too much padding here, the options won't show in IE */
  width: 268px;
  }
  .num1{
    background-color:white;
    position:relative;
  }
  .dx{
    font-size:15px;
    font-weight:bold;
    float:right;
    width:70%;
    height:50%;
    position: relative;
  }
  .cont{
    display:block;
  }
  .titles{
    font-size:20px;
    font-weight:bold;
  }
  .cq,.cm,.av,.qu{
   border: 1px solid #3dcacd;
   padding:2px;
   border-radius:4px;
    height:100%;
    width:50%;
    float:left;
  }
  .context{
    font-size:15px;
  }
  .ci{
   font-size:10px;
   padding:4px;
  }
  .rounded {
  -webkit-border-radius: 15px;
  -moz-border-radius: 15px;
  border-radius: 15px;
  }
  .time{
  text-align:center;
  }
  .bike{
  color: #3dcacd;
  text-align:left;
  font-size:15px;
  }
  .black   { background-color: #3dcacd; }
  #myTab a, a:active, a:visited{border:1px solid #3dcacd;box-shadow: 2px 2px 1px grey;}
  #myTab a:hover {color:  #3d3a3a; background-color: #3dcacd;border:1px solid  #AFABAA;
    border-radius:3px; }
  #myTab a:focus{ color:  #3d3a3a; background-color: #3dcacd;border:1px solid  #AFABAA;
    border-radius:3px; }
    .links{ color:  #3d3a3a; background-color: #3dcacd;border:1px solid  #AFABAA;
      border-radius:3px;box-shadow: 2px 2px 1px grey;

    }
    .button-3 {border-radius: 8px; color:  #3d3a3a; background-color: #3dcacd; margin-left:2px;}


  .centered_item{
      display:flex;
      justify-content:center;
      align-items:center;
      color: black;

    }

  .table_style{
    border-right-color: grey;
    border-right-style: solid;
    border-right-width: 1px;
    border-left-color: grey;
    border-left-style: solid;
    border-left-width: 1px;
    border-bottom-color: grey;
    border-bottom-style: solid;
    border-bottom-width: 1px;
    border-top-color: white;
    border-top-style:solid;
     border-top-width: 2px;
    width:100%;
    border-top-left-radius: 15px;
     border-top-right-radius: 15px;
     background-color:#3d3a3a;
  }
.canceledElem{
 background-color: red;
 opacity: 1;
}



.modal-content{
  background-color:#3d3a3a;
}
td{
  background: rgba(204, 204, 204, 0.9);
}
  thead{
     background:darkgrey;
  }
.btn{
 margin: 2px;
}
.btn:hover{
transition:0.3s;

}
 </style>

{% endblock %}
{% block body %}
<body onload="toggle_visibility('left');">
  <div class="container">
    <h2>Hey there! </h2>
    <h4>Below you can find all the information about you future and past reservations. </h4>

<!-- toggle buttons -->
<div class='centered_item'>
<div onclick="toggle_visibility('left');leftFun();" class="toggle_btn clicked_btn" id= 'left_toggle_btn'>
<center>  <h3>Past Reservations</h3></center>

</div>

<div onclick="toggle_visibility('right'); rightFun();" class='toggle_btn  not_clicked_btn ' id='right_toggle_btn' >
 <center><h3> Future Reservations</h3></center>
</div>
</div>
<!-- The table starts -->
<div class='centered_item table-responsive'>
     <div id="left" class="table_style">

  <table class="table table-hover">
    <tbody>
         {% for record in pastreservations %}
         <tr style="border-top:5px solid #3d3a3a;"><td style=" background-color:#3d3a3a;color:white;"><h4>RESERVATION: {{ record.res_code }}</h4></td><td style="color:white; background-color:#3d3a3a;"></td></tr>
         <tr>
<td  style="width:100%;"> <button type="button" id ="myBtnFeedback"  class="btn btn-info">Send Feedback</button></td>
<td  style="width:100%;"> <button type="button" id ="myBtnFeedback"  class="btn btn-danger">PAY YOUR FINE!</button></td>
          </tr>
         <tr>
                  <td style="font-size:15px;border:3px solid green;border-radius:2px;">{{ record.startname }}<br>{{ record.starttime }}</td>
                  <td style="font-size:15px;border:3px solid red;">{{ record.endname }}<br>{{ record.endtime }}</td>
        </tr>
        <tr> <td>
          {% for bike in bikesonreservations %}
          {% if bike.bor_reservation_id == record.reservation_id %}
        <img style="width:50px;height:50px;-webkit-filter: drop-shadow(1px 1px 0 black)
  drop-shadow(-1px -1px 0 white);
  filter: drop-shadow(1px 1px 0 white)
  drop-shadow(-1px -1px 0 black);" src="{% static 'bikes/'|add:bike.bike_type.bike_image %}">{{ bike.bike_type.bike_type }}<br>
          {% endif %}
            {% endfor %}
        </td>
           <td>RESERVED ON: {{ record.res_date }}<br>PAID: {{ record.res_cost }}</td>
         </tr>
            {% endfor %}
    </tbody>
</table>

</div>

 <div id="right"  class='table_style ' >
      <table class="table table-hover">

  <tbody>
       {% for record in futurereservations %}
       <tr style="border-top:5px solid #3d3a3a;"><td style=" background-color:#3d3a3a;color:white;"><h4>RESERVATION: {{ record.res_code }}</h4></td><td style="color:white; background-color:#3d3a3a;"></td></tr>
       <tr>
                <td style="font-size:15px;border:3px solid green;border-radius:2px;"><span id='st{{ record.reservation_id }}'>{{ record.startname }}</span> <span id='stt{{ record.reservation_id }}'>{{ record.starttime }}</span> </td>
            <td><button id="modalButton" name='{{ record.reservation_id }}' type="button" class="btn btn-warning modals" style="width:100%;"data-toggle="modal" data-target="#exampleModal">Edit</button>
<!--------------
              <form action="/home/reservations/" method="POST" name="time-edit" class="timeedit">
                <button id='myBtnEdit' type="submit" name='{{ record.reservation_id }}' class="btn btn btn-warning myBtnEdit" style="width:100%;">Edit Time</button></td>
              </form>
      <!---------------->
        </tr>
      <tr >
               <td style="font-size:15px;border:3px solid red;"><span id='en{{ record.reservation_id }}'>{{ record.endname }}</span>  <span id='ent{{ record.reservation_id }}'>{{ record.endtime }}</span></td>
               <td> {% if now.date < record.starttime.date %} <button type="button" id="myBtnCancel" class="btn btn-danger" style="width:100%;">Cancel</button>{% endif %}</td>
      </tr>
      <tr> <td colspan='2'>
        {% for bike in bikesonreservations %}
        {% if bike.bor_reservation_id == record.reservation_id %}
      <img style="width:50px;height:50px;-webkit-filter: drop-shadow(1px 1px 0 black)
drop-shadow(-1px -1px 0 white);
filter: drop-shadow(1px 1px 0 white)
drop-shadow(-1px -1px 0 black);" src="{% static 'bikes/'|add:bike.bike_type.bike_image %}">{{ bike.bike_type.bike_type }}
        {% endif %}
          {% endfor %}
      </td>
       </tr>
        <tr>
           <td>RESERVED ON: {{ record.res_date }}</td>
           <td>PAID:<span id="cos{{ record.reservation_id }}" >{{ record.res_cost }}</span></td>

         </tr>
          {% endfor %}
  </tbody>
</table>

 </div>
  </div>
</div>

<!--EDIT RESERVATION -->
<div class="modal fade" id="exampleModal" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog dia" role="document">
    <div class="modal-content">
      <div class="modal-header header column-4">
        <button type="button" style="float:left;opacity:9; color:#3dcacd;" id="clickme" onclick="reset()" class="close" data-dismiss="modal">
        <span aria-hidden="true">&times;</span></button><br>
        <h5 class="modal-title tit" id="exampleModalLabel"></h5>
        <div>
          Start Station <br><div class="start" id="startloc" ></div>
          End Station <br><div class="end" id="endloc"></div><br>
          <p class="information" id="startinfo"></p>
          <p class="information" id="endinfo"></p>
          <ul class="nav nav-tabs nav-justified" id="myTab" role="tablist">
            <li class="nav-item">
              <a onclick="resetHomeSelect()" class="nav-link active" id="home-tab" data-toggle="tab" href="#home1" role="tab" aria-controls="home1" aria-selected="true">Time</a>
            </li>
            <li class="nav-item">
              <a onclick="resetBikeSelect()" class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false" style="display:none;">Bike</a>
            </li>
          </ul>
        </div><br>
        <table style="width:100%;">
        <tr>
          <td style="border-bottom:1px solid;">Time</td><td style="border-bottom:1px solid;">€<span style="text-align:left;" id="cost">0</span></td></tr>
        <tr><td style="border-bottom:1px solid;">Bike</td><td style="border-bottom:1px solid;">€<span style="text-align:left;" id="cyclecost">0</span></td></tr>
        <tr><td>Total</td><td> €<span style="text-align:left;" id="totalcost">0</span></td></tr>
        </table>
      </div>
      <div class="modal-body bod column-8">

        <div class="tab-content" id="myTabContent">
          <div class="tab-pane fade" id="home1" role="tabpanel" aria-labelledby="home-tab">
            <ul class="list-group" >
              <li class="list-group-item time" style="color: #3dcacd;font-size: 20px;font-weight:bold;">
                <u>Select your reservation time</u><br> €5/15 minutes
              </li>
               <li class="list-group-item time">
                 <button onclick="resetSelect()" type="button" class="links">
                   <span >Reset</span>
                 </button>
               </li>
               <li class="list-group-item time">
                 <select class="styled-select black rounded" id="select_start_date">
                 <option disabled selected value>Select Start Date</option>
               </select>
               </li>
               <li class="list-group-item time">
                 <select class="styled-select black rounded" id="select_end_date">
                   <option disabled selected value>Select End Date</option>
                 </select>
               </li>
               <li class="list-group-item time">
                 <select class="styled-select black rounded" id="select_start_time">
                   <option disabled selected value>Select Start Time</option>
                 </select>
               </li>
               <li class="list-group-item time">
                 <select class="styled-select black rounded" id="select_end_time">
                   <option disabled selected value>Select End Time</option>
                 </select>
               </li>
               <li class="list-group-item">
                 <form action="/home/reserve/" method="POST" name="time-form" id="timeform">
                      <button id="confirm" onclick="bikeSelect()" type="submit" style="background-color:#4CAF50;border-color:#4CAF50; color: black" class="btn btn-primary btn-md">
                        <span>Continue to bike selection</span>
                      </button>
                   </form>
               </li>
           </ul>
        </div>
          <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
            <div>
                <ul class="list-group">
                  <li class="list-group-item time" style="color: #3dcacd;font-size: 20px;font-weight:bold;">
                    <u>Edit your reservation <br>Add more bikes</u>
                  </li>
                    <li class="list-group-item time" style="height:50px;">
                        <form action="/home/reserve/" method="POST" name="bike-form" id="bikeform">
                          <button id="confirm2" onclick="timeSelect()" type="submit"  style="background-color:#4CAF50;border-color:#4CAF50; color: black;" class="btn btn-primary btn-md">
                            <span>Confirm</span>
                          </button>
                        </form>
                    </li>
                  <li class="list-group-item">

                        <div style="width:10%;height:100%;">
                    <button onclick="resetSelectBike()" type="button" class="links">
                      <span >Reset</span>
                    </button>
                      </div>
                  </li>
                  {% for bike in bike_type %}
                    <li class="list-group-item bike">
                      <div class="row">
                        <div class="column-1">
                          <div class="dx">
                            <span id="bike{{ bike.bike_type_id }}"> {{ bike.bike_type }}</span>
                          </div>
                          <div class="col1">
                            <img style="width:50px;height:50px;-webkit-filter: drop-shadow(1px 1px 0 black)
              drop-shadow(-1px -1px 0 white);
filter: drop-shadow(1px 1px 0 white)
      drop-shadow(-1px -1px 0 white);" src="{% static 'bikes/'|add:bike.bike_image %}">
                          </div>
                          <div class="col2">
                            <button class="button-3" onclick="addBike('bike{{ bike.bike_type_id }}')">+</button>
                            <button class="button-3" onclick="removeBike('bike{{ bike.bike_type_id }}')">-</button>
                          </div>
                        </div>
                        <div class="column-2">
                          <div class="num1">
                          <div class="av">Available:<span id="available{{ bike.bike_type_id }}">{{ maxbikes }}</span></div>
                          <div class="qu">Quantity:<span id="quantity{{ bike.bike_type_id }}">0</span></div>
                          </div>
                          <div class="num2">
                          <div class="cq">Cost*Quantity: €<span id="quantitycost{{ bike.bike_type_id }}">0</span></div>
                          <div class="cm">Cost/15mins: €<span id="costperfifteen{{ bike.bike_type_id }}">{{ bike.bike_cost }}</span></div>
                          <div class="ci"><span>{{ bike.bike_model }}</span> is a
                          {{ bike.bike_info }}
                          </div>
                        </div>
                      </div>
                  </li>
                  {% endfor %}
                  </ul>
                </div>
              </div>
            </div>
          </div>
          </div>
    </div>
  </div>
  <!-- Button trigger modal -->
  <button id="modalButton1" type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal1">
  </button>

  <!-- Modal -->
  <div class="modal fade" id="exampleModal1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content cont">
        <div class="modal-header">
          <h5 class="modal-title titles" id="exampleModalLabel1">Would you like to confirm the following reservation?</h5>
        </div>
        <div class="modal-body context">
          <ul class="list-group">
            <li class="list-group-item">
              <li class="list-group-item" style="color:#3dcacd;">End Station <span style="font-weight:bold" id="ends"></span></li>
              <li class="list-group-item" style="color:#3dcacd;">Start Station <span style="font-weight:bold" id="starts"></span></li>
          <li class="list-group-item" style="color:#3dcacd;">Your reservation will start at <span style="font-weight:bold" id="starting"></span></li>
          <li class="list-group-item"  style="color:#3dcacd;">Your reservation will end at <span style="font-weight:bold" id="ending"></span></li>
        <li class="list-group-item"  id="biked" style="color:#3dcacd;">Bikes reserved:<br></li>
        <li class="list-group-item"  style="color:#3dcacd;">Total Hourly based cost is  €<span style="font-weight:bold" id="hourly"></span></li>
      <li class="list-group-item"  style="color:#3dcacd;">Total Bike selected cost is €<span style="font-weight:bold" id="bikebased"></span></li>
      <li class="list-group-item"  style="color:#3dcacd;">The Final Total cost to pay  €<span style="font-weight:bold;font-size:20px;" id="finaltotal"></span></li>
      <li class="list-group-item"  style="color:#3dcacd;"><h3>MAKE SURE TO ARRIVE AT THE STATION ON TIME! OR YOU WILL BE FINED!</h3></li>
      <li class="list-group-item"  style="color:#3dcacd;"><h3>YOU CANNOT CANNOT YOUR RESERVATION 24 HOURS BEFORE THE START OF YOUR RESERVATION!</h3></li>
          </ul>
            <form  method="post" name="myform">
              {% csrf_token %}
           <input type="hidden" name="inputendstation" id="inputendstation" value=""/>
            <input type="hidden" name="inputstartstation" id="inputstartstation" value=""/>
              <input type="hidden" name="reservation" id="reservationt" value=""/>
             <input type="hidden" name="inputstarttime" id="inputstarttime" value=""/>
              <input type="hidden" name="inputendtime" id="inputendtime" value=""/>
              <input type="hidden" name="inputenddate" id="inputenddate" value=""/>
              <input type="hidden" name="inputstartdate" id="inputstartdate" value=""/>
              <input type="hidden" name="inputtotal" id="inputtotal" value=""/>
                {% for bike in bike_type %}
              <input type="hidden" name="inputbike{{ bike.bike_type_id }}" id="inputbike{{ bike.bike_type_id }}" value="">
              {% endfor %}
          <button type="button" class="btn btn-secondary" style="color: #3d3a3a;" onclick="reload_page()" data-dismiss="modal">Go back to Reservations Log</button>
          <button type="submit" onclick="send()" class="btn btn-primary">Proceed to Pay</button>
          </form>
        </div>
      </div>
    </div>
  </div>
  <!-- The Modal -->
  <div class="modal" id="myFeedbackModal">
    <div class="modal-dialog">
      <div class="modal-content" >

        <div class="modal-header" style="border-bottom: 0px; margin-bottom: 0px; padding-bottom: 0px;">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
      <div class="centered_item" style=" margin-bottom: 2%;" >
        <div class="modal-body "  style=" height: 50%; min-height: 100px;  width: 90%; margin-top: 0px;">
        <h2 style="color: rgba(0, 179, 179, 1); font-weight: bold;"> Feedback Form</h2>
        <h3 style="color:white; "> Thank you for taking your time to comment on our service! Your feedback is very important to us!</h3>
        <h4 style="color: black;"> Gentle reminder that you are about to send feedback about the so and so trip at so and so day </h4>
        <div class="input-group " style="width:100%; margin-top:5%;">
              <textarea class="form-control" aria-label="With textarea" style=" margin-bottom: 1%;" ></textarea>
              <button type="submit"  id="myBtnSubmitFeedback" data-dismiss="modal" class="btn btn-success" onclick="sendFeedback(this);" style="width: 100%;">Submit</button>
        </div>
         <div>

         </div>
        </div>

        </div>
      </div>
    </div>
  </div>
<script>
  document.getElementById('modalButton1').style.display="none";
  var x = 0;
  var startlocationid;
  var endlocationid;
  var startlocationname='';
  var endlocationname='';
  var i=0;
  document.getElementById("confirm2").style.display="none";
  document.getElementById("home-tab").style.display="none";
  const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun","Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
  var startTime;
  var endTime;
  var startDate;
  var endDate;
  var bru=true;
  var bike = {}
    {% for bike in bike_type %}
          bike[{{ bike.bike_type_id }}] = 0;
    {% endfor %}
  var bikesselected=false;
  var timesselected=false;
  var repeat = false;
  var done=0;
  var reservationnumber;
  $(".modals").click(function() {
    reservationnumber=this.name;
  });
   $('#exampleModal').on('show.bs.modal', function (event) {
       var modal = $(this);
       modal.find('.tit').text('Edit your reservation');
       $('#startloc').text($('#st'+reservationnumber).text());
       $('#endloc').text($('#en'+reservationnumber).text());
       startTime=formatToStringTime($('#stt'+reservationnumber).text().split(' '));
       endTime=formatToStringTime($('#ent'+reservationnumber).text().split(' '));
       startDate=formatToStringDate($('#stt'+reservationnumber).text().split(' '));
       endDate=formatToStringDate($('#ent'+reservationnumber).text().split(' '));
       timesselected=true;
       document.getElementById("confirm").click();
   });
   function formatToStringTime(time)
   {
     if(time.length==4)
     {
        if(time[3]=='noon')
        {
          return '12:00 PM';
        }
        else if(time[3]=='midnight')
        {
          return '12:00 AM';
        }
     }
     else if(time.length=5)
     {
       var hours = time[3];
       if(hours.split(":").length==1)
       {
          hours=hours.split(":")[0]+':00';
       }
        return hours+' '+time[4].toUpperCase().substring(0, time[4].length - 1).replace(".","");
     }
   }
   function formatToStringDate(date)
   {
        return date[1].replace(",","")+' '+date[0].replace(".","")+' '+date[2].replace(",","");
   }

  function disable(selector) {
    document.getElementById(selector).selectedIndex=0;
    document.getElementById(selector).style.color= "grey" ;
    document.getElementById(selector).disabled = true;
  }
  function enable(selector) {
        document.getElementById(selector).selectedIndex=0;
        document.getElementById(selector).style.color= "black" ;
        document.getElementById(selector).disabled = false;
  }
  function confirmed()
  {
    $('#exampleModal').fadeOut();
    $("#hourly").text($("#cost").text());
    $("#starts").text($('#startloc').text());
    $("#ends").text($('#endloc').text());
    $("#bikebased").text($("#cyclecost").text());
    $("#finaltotal").text($("#totalcost").text());
    {% for bike in bike_type %}
    if(Number($("#quantity{{ bike.bike_type_id }}").text())!=0){
          $("#biked").append(($("#quantity{{ bike.bike_type_id }}").text())+" of {{ bike.bike_type }}  "+"<br>");}
      {% endfor %}
    $("#ending").text(endTime+" on "+endDate);
    $("#starting").text(startTime+" on "+startDate);
    document.getElementById("modalButton1").click();
  }
  function send()
  {
    document.getElementById("inputstartstation").value=($('#startloc').text());
      document.getElementById("reservationt").value=reservationnumber;
    document.getElementById("inputendstation").value=($('#endloc').text());
                        {% for bike in bike_type %}
    document.getElementById("inputbike{{ bike.bike_type_id }}").value=(bike[{{ bike.bike_type_id }}]);
                          {% endfor %}
    document.getElementById("inputstarttime").value=(startTime);
    document.getElementById("inputendtime").value=(endTime);
    document.getElementById("inputstartdate").value=(startDate);
    document.getElementById("inputenddate").value=(endDate);
    document.getElementById("inputtotal").value=($('#totalcost').text());
    document.myform.submit();
  }
  function removeBike(selector) {
         var num = selector[selector.length -1];
         if($('#quantity'+num).text()>0)
          {
            var cost = {{ costperhour }}/4;
             $('#available'+num).text(Number($('#available'+num).text())+1);
              $('#quantity'+num).text(($('#quantity'+num).text())-1);
              if((Number($('#cost').text()))==0)
              {
              $('#quantitycost'+num).text(((Number($('#quantity'+num).text()))*(Number($('#costperfifteen'+num).text()))));
              $('#cyclecost').text(Number($('#cyclecost').text())-(Number($('#costperfifteen'+num).text())));
              }
              else {
              $('#quantitycost'+num).text(((Number($('#quantity'+num).text()))*((Number($('#costperfifteen'+num).text()))*((Number($('#cost').text()))/cost))));
              $('#cyclecost').text(Number($('#cyclecost').text())-(((Number($('#costperfifteen'+num).text()))*((Number($('#cost').text()))/cost))));
              }
              $('#totalcost').text(Number($('#cyclecost').text())+Number($('#cost').text()));

          }
          if(({% for bike in bike_type %}
                (Number($('#quantity{{ bike.bike_type_id }}').text()))+
          {% endfor %}0)==0)
          {
            bikesselected=false;
              document.getElementById("confirm2").style.display="none";
          }
  }
  function addBike(selector) {
    var num = selector[selector.length -1];
    if(Number($('#available'+num).text())>0)
     {
       document.getElementById("confirm2").style.display="block";
       var cost = {{ costperhour }}/4;
       $('#available'+num).text(($('#available'+num).text())-1);
       $('#quantity'+num).text(Number($('#quantity'+num).text())+1);
       if((Number($('#cost').text()))==0)
       {
       $('#quantitycost'+num).text(((Number($('#quantity'+num).text()))*(Number($('#costperfifteen'+num).text()))));
       $('#cyclecost').text(Number($('#cyclecost').text())+(Number($('#costperfifteen'+num).text())));
        }
        else {
       $('#quantitycost'+num).text(((Number($('#quantity'+num).text()))*((Number($('#costperfifteen'+num).text()))*((Number($('#cost').text()))/cost))));
       $('#cyclecost').text(Number($('#cyclecost').text())+(((Number($('#costperfifteen'+num).text()))*((Number($('#cost').text()))/cost))));
      }
     $('#totalcost').text(Number($('#cyclecost').text())+Number($('#cost').text()));
        }
  }
  //https://stackoverflow.com/questions/32890938/next-7-days-in-drop-down-list
  function formatDate(date) {
            var d = new Date(date),
                    day = '' + d.getDate(),
                    month = '' + (d.getMonth() + 1),
                    year = '' +d.getFullYear();
            if (day.length < 2)
                day = '0' + day;
            return [day,monthNames[month-1],year].join(' ');
        }
  function resetSelectBike()
  {
    {% for bike in bike_type %}
         bike[{{ bike.bike_type_id }}] = 0;
      {% endfor %}
      {% for bike in bike_type %}
        for(var i=0;i<Number($('#available'+{{bike.bike_type_id }}).text());i++)//CHANGE TO AVAILABLE BIKES
        {
          removeBike('bike{{ bike.bike_type_id }}');
        }
      {% endfor %}

      $('#totalcost').text($('#cos'+reservationnumber).text());
      $('#cyclecost').text(Number($('#totalcost').text())-Number($('#cost').text()));
  }
  function resetSelect(){
    populateDate('#select_start_date','Select Start date',{{ reservationdays }},new Date); // use selector for your select
    disable("select_end_date");
    disable("select_end_time");
    disable("select_start_time");
     document.getElementById("confirm").style.display="none";
     $("#totalcost").text($("#totalcost").text()-(Number($("#cost").text())));
       $("#cost").text("0");
  }
  function resetHomeSelect(){
    if(timesselected==true)
    {
      resetSelectBike();
      timesselected = false;
      document.getElementById("home-tab").style.display="none";
    }
    else {
      populateDate('#select_start_date','Select Start date',{{ reservationdays }},new Date); // use selector for your select
      disable("select_end_date");
      disable("select_end_time");
      disable("select_start_time");
       document.getElementById("confirm").style.display="none";
       if(bikesselected==false || (bikesselected== true && repeat==false))
       {
            resetSelectBike();
           $("#cyclecost").text("0");
       }
       else {
         repeat=false;
          $("#totalcost").text($("#totalcost").text()-(Number($("#cost").text())));
          $("#cost").text("0");
       }
    }
  }

  function resetBikeSelect(){

      if(timesselected==false)
      {
        $("#totalcost").text($("#totalcost").text()-(Number($("#cost").text())));
          $("#cost").text("0");
      }
      else
      {
        {% for bike in bike_type %}
          bike[{{ bike.bike_type_id }}] = 0;
        {% endfor %}
        {% for bike in bike_type %}
          for(var i=0;i<Number($('#available'+{{bike.bike_type_id }}).text());i++)//CHANGE TO AVAILABLE BIKES
          {
              removeBike('bike{{ bike.bike_type_id }}');
            }
        {% endfor %}
        var cost=0;
        var costperfifteen={{ costperhour }}/4;
        st=convertMinutes(startTime);
        et=convertMinutes(endTime);
        if(startDate==endDate)
        {
            for(var i = st; i < et; i += 15){
              cost=costperfifteen+cost;
        }
        }
        else {
          for(var i = st; i < 1440; i += 15){
              cost=costperfifteen+cost;
            }
        for(var i = 0; i < et; i += 15){
            cost=costperfifteen+cost;
          }
        }
        $('#cost').text(Number(cost));
        $('#totalcost').text($('#cos'+reservationnumber).text());
        $('#cyclecost').text(Number($('#totalcost').text())-Number($('#cost').text()));
      }
  }
  function convertMinutes(i)
  {
    var ampm=i.split(" ");
    var all = ampm[0].split(":");
    if(ampm[1]=='PM')
    {
      if(Number(all[0])=='12')
      {
          return (12 * 60) + Number(all[1]);
      }
      return (12* 60 ) +(Number(all[0]) * 60) + Number(all[1]);
    }
    else if(ampm[1]=='AM')
    {
      if(all[0]=='12')
      {
          return (0 * 60) + Number(all[1]);
      }
      return (Number(all[0]) * 60) + Number(all[1]);
    }
  }
  function timeSelect(){

    {% for bike in bike_type %}
        bike[{{ bike.bike_type_id }}]=Number($('#quantity{{ bike.bike_type_id }}').text());
      {% endfor %}
    var total = 0;
    {% for bike in bike_type %}
          total = total+bike[{{ bike.bike_type_id }}];
      {% endfor %}
    if((total)>0)
    {
          bikesselected=true;
    }
    if(bikesselected==true && timesselected==true)
    {
      confirmed();
      return;
    //  alert("Done1");
    }
    repeat=true;
    document.getElementById("home-tab").click();
  }
  function bikeSelect() {
if(bru==true){
    //select all times from all dates that are not full
    $('#startinfo').text('Start: '+ startDate+' '+startTime);
    $('#endinfo').text('End: '+ endDate+' '+endTime);
    timesselected=true;
    if(bikesselected==true && timesselected==true)
    {
      confirmed();
    //  alert('Done2');
    }
  }
  }

  $(document).ready(function(){
 setInterval(function(){ reload_page(); },60*60000);
  });

  function reload_page()
  {
    window.location.reload(true);
  }
  $(function() {


  // This function gets cookie with a given name
  function getCookie(name) {
      var cookieValue = null;
      if (document.cookie && document.cookie != '') {
          var cookies = document.cookie.split(';');
          for (var i = 0; i < cookies.length; i++) {
              var cookie = jQuery.trim(cookies[i]);
              // Does this cookie string begin with the name we want?
              if (cookie.substring(0, name.length + 1) == (name + '=')) {
                  cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                  break;
              }
          }
      }
      return cookieValue;
  }
  var csrftoken = getCookie('csrftoken');

  /*
  The functions below will create a header with csrftoken
  */

  function csrfSafeMethod(method) {
      // these HTTP methods do not require CSRF protection
      return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
  }
  function sameOrigin(url) {
      // test that a given url is a same-origin URL
      // url could be relative or scheme relative or absolute
      var host = document.location.host; // host + port
      var protocol = document.location.protocol;
      var sr_origin = '//' + host;
      var origin = protocol + sr_origin;
      // Allow absolute or scheme relative URLs to same origin
      return (url == origin || url.slice(0, origin.length + 1) == origin + '/') ||
          (url == sr_origin || url.slice(0, sr_origin.length + 1) == sr_origin + '/') ||
          // or any other URL that isn't scheme relative or absolute i.e relative.
          !(/^(\/\/|http:|https:).*/.test(url));
  }

  $.ajaxSetup({
      beforeSend: function(xhr, settings) {
          if (!csrfSafeMethod(settings.type) && sameOrigin(settings.url)) {
              // Send the token to same-origin, relative URLs only.
              // Send the token only if the method warrants CSRF protection
              // Using the CSRFToken value acquired earlier
              xhr.setRequestHeader("X-CSRFToken", csrftoken);
          }
      }
  });

});
  $('#timeform').on('submit', function(event){
  event.preventDefault();
  time_post();
});
// AJAX for posting
function time_post() {
$.ajax({
      url : "/home/reserve/", // the endpoint
      type : "POST", // http method
      data : { formtype : 'time', starttime: startTime , endtime: endTime, startdate: startDate, enddate: endDate,startstation: $('#startloc').text(),endstation:$('#endloc').text()}, // data sent with the post request

      // handle a successful response
      success : function(json) {
        if (
        //this part checks if all the available bikes added together ==0 if yes then returns 0
        {% for bike in bike_type %}
        json.result{{ bike.bike_type_id }} +
      {% endfor %}0 == 0)
      {
        alert("Sorry, there are no bikes available for that timing, try again");
      bru=false;
      document.getElementById('clickme').click();
    //  reload_page();
      }
      //This else loop sets the available bikes for each of the bike types
      else{
        {% for bike in bike_type %}
        $('#available{{ bike.bike_type_id }}').text(json.result{{ bike.bike_type_id }}); // remove the value from the input
      {% endfor %}
      document.getElementById("profile-tab").click();
    }
      },

      // handle a non-successful response
      error : function(xhr,errmsg,err) {
              }
  });
};
$('#bikeform').on('submit', function(event){
event.preventDefault();
bike_post();
});
// AJAX for posting
function bike_post() {
$.ajax({
  url : "/home/reserve/", // the endpoint
  type : "POST", // http method
  data : { formtype: 'bike', bikes: bike}, // data sent with the post fo
  // handle a successful response
  success : function(json) {
      $('#post-text').val(json.result); // remove the value from the input
  },

  // handle a non-successful response
  error : function(xhr,errmsg,err) {
          }
});
};
//-------------------------------------
$('.timeedit').on('submit', function(event){
event.preventDefault();
edit_post();
});
// AJAX for posting
function edit_post() {
$.ajax({
  url : "/home/reservations/", // the endpoint
  type : "POST", // http method
  data : { formtype: 'timeedit', reservationnumber:reser}, // data sent with the post fo
  // handle a successful response
  success : function(json) {
    //IF ELSE LOOP IF NO TIME THEN DISPLAY ERROR AND CLICK CANCEL BUTTON
    //IF THERE ARE NO TIMES AVAILABLE THEN :
    //alert('Sorry, there are no other times you can change, other reservations occupied')
    //document.getElementById('pleaseclose').click();
        alert(json[1]); // remove t // remove the value from the input
  },

  // handle a non-successful response
  error : function(xhr,errmsg,err) {
          }
});
};
//------------------------------------------
  </script>
 <!-- Information model -->

  <div class="modal" id="myInformationModal">
    <div class="modal-dialog">
      <div class="modal-content" >

        <div class="modal-header" style="border-bottom: 0px; padding-bottom: 0px;">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
      <div class="centered_item" style=" margin-bottom: 2%; margin-top: 0px;" >
        <div class="modal-body "  style=" height: 50%; min-height: 100px;  width: 90%; margin-top: 0px;">
        <h3 style="color:white; "> Changes have been made!</h3>
        <h3 style="color:white;"> Thank you for using our service! </h3>
        <button type="button" data-dismiss="modal" class="btn btn-success" style="width: 100%;">Okay!</button>

         <div>

         </div>
        </div>

        </div>
      </div>
    </div>
  </div>

 <!-- The Cancelation Modal -->
   <div class="modal" id="myCancelationModal">
    <div class="modal-dialog">
      <div class="modal-content" >

        <div class="modal-header"  style="border-bottom: 0px; padding-bottom: 0px;">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body" >


          <h4 class="centered_item"  style="color: white; margin-top: 2%; margin-bottom: 5%; width:100%;">Are you sure you want to cancel your reservation? </h4>

            <button type="button" id="cancelReservation" data-dismiss="modal" style="width: 100%;" class="btn btn-success centered_item" onclick="cancelReservation(this);" >Yes</button>
            <button type="button" data-dismiss="modal" style="width: 100%;" class="btn btn-danger centered_item">No</button>
        </div>



      </div>
    </div>
  </div>
   <!-- The Edit Modal -->
   <div class="modal" id="myEditModal">
    <div class="modal-dialog">
      <div class="modal-content">

        <div class="modal-header" style="border-bottom: 0px; padding-bottom: 0px;">
          <button type="button" class="close" id='pleaseclose' data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
           <h2 style="color: rgba(0, 179, 179, 1); margin-left: 2%; font-weight: bold;">Edit reservation timing</h2>
          <form>
            <div class="form-group col-md-6" style="width:100%;">
              <h4>Current Pick up time</h4>
              <p id='currentpickuptime'></p>
              <h4>Current Drop Off time</h4>
              <p id='currentdropofftime'></p>
              <!--<h4>Time €<span id="currentcost">0</span></h4>
              <h4>Bike €<span  id="cyclecost">0</span></h4>-->
              <h4>Total €<span id="currentcost">0</span></h4>
            </div>
              <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="startTime">Change Pick up time from <span id='currentstartstation'></span></label>
                  <select class="styled-select black rounded" id="currentstarttime">
                    <option disabled selected value>Change Pick Up Time</option>
                  </select>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group col-md-6">
                  <label for="endTime">Change Drop off time to <span id='currentendstation'></span></label>
                  <select class="styled-select black rounded" id="currentendtime">
                    <option disabled selected value>Change Drop Off Time</option>
                  </select>
                </div>
              </div>
                <div class="form-group col-md-6" style="width:100%;">
                </div>


            <div class="form-group col-md-6" style="border-top: solid 1 px white; width: 100%;">

              <h4>You will be charged: XX$</h4>
            </div>
             <button type="submit" class="btn btn-success"  id="myBtnSubmitChanges" data-dismiss="modal" onclick="editDetails()" style="width: 100%;">Proceed</button>

            </form>


        </div>



      </div>
    </div>
  </div>
  <!---------------------------------------->
<script>
  $('#currentstarttime').change(function() {
    var select = $('#currentendtime');
    select.empty().append($('<option disabled selected value>'+'Edit Drop off time'+'</option>'));
    select.append($('<option></option>')
        .attr('value', 6)
        .text(':'+' ' ));
    select.append($('<option></option>')
            .attr('value', 5)
            .text('dfgdf:'+' ' ));
    document.getElementById('currentendtime').selectedIndex=0;
    document.getElementById('currentendtime').style.color= "black" ;
    document.getElementById('currentendtime').disabled = false;
    document.getElementById('myBtnSubmitChanges').style.display="none";
  });
  $('#currentendtime').change(function() {
  document.getElementById('myBtnSubmitChanges').style.display="block";
  });
</script>
<!------------------------------------------>
</body>
{% endblock %}
