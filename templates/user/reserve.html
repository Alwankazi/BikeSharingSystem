{% extends 'base.html' %}
{% load static %}
{% block head %}
<meta charset='utf-8' />
   <title></title>
   <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
   <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.52.0/mapbox-gl.js'></script>
   <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.52.0/mapbox-gl.css' rel='stylesheet' />
    <link rel="stylesheet" href= "{% static 'main/reserve.css' %}" type="text/css">
    {% endblock %}
    {% block body %}
    <div id='map'></div>
    <button id="modalButton" type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
  Launch demo modal
</button>
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Make a reservation</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
        ...
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary">Save changes</button>
          </div>
        </div>
      </div>
    </div>
    <script>
    document.getElementById('modalButton').style.display="none";
    mapboxgl.accessToken = 'pk.eyJ1IjoibWFyaXVtc2FyYWgiLCJhIjoiY2pxcW01MGN1MGNxODQ4cWdyeGcxYmg4bSJ9.6FZ55yUsUcY9I6H6DC4_9Q';
    var map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/dark-v9',
      center: [-3.1883,55.9533],
      zoom: 11
    });
    map.doubleClickZoom.disable();
    // code from the next step will go here!
    var geojson = [
    {% for station in stations %}
        {% if not forloop.first %},{% endif %}
        {
            station_id: "{{ station.station_id }}",
            address: "{{ station.address }}",
            capacity: "{{ station.capacity }}",
            lat: "{{ station.lat }}",
            lon: "{{ station.lon }}",
            name: "{{ station.name }}",
            numbikesavailable: "{{ station.num_bikes_available }}",
            lastreported: "{{ station.last_reported }}",
            isintalled: "{{ station.is_installed }}",
            numdocksavailable: "{{ station.num_docks_available }}",
            stationid: "{{ station.station_id }}",
            isrenting: "{{ station.is_renting }}",
            isreturning: "{{ station.is_returning }}"
        }
    {% endfor %}
    ]
    var x = 0
    var startlocation;
    var endlocation;
    // add markers to map
geojson.forEach(function(marker) {

  // create a HTML element for each feature
  var el = document.createElement('div');
  el.className = 'marker';
  el.addEventListener('dblclick', () =>
     {
       if(x==1)
       {
        el.style.backgroundColor = "red";
        el.style.width = "25px";
         el.style.height = "25px";
         document.getElementById("modalButton").click();
         endlocation=marker.station_id;
       }
       else{
         el.style.backgroundColor = "green";
         el.style.width = "25px";
         el.style.height = "25px";
         startlocation=marker.station_id;
       }
       x=x+1;
     }
  );
  // make a marker for each feature and add to the map
  new mapboxgl.Marker(el)
    .setLngLat([marker.lon,marker.lat])
    .setPopup(new mapboxgl.Popup({ offset: 25 }) // add popups
    .setHTML('<h3>' + marker.address + '</h3><p>Name: ' + marker.name +'<br>Number of bikes available:'+ marker.numbikesavailable +'<br>Number of docks available:'+ marker.numdocksavailable +'<br>Capacity:'+ marker.capacity + '</p>'))
    .addTo(map);
});
    </script>

{% endblock %}
