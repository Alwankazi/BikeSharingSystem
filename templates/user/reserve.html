{% extends 'base.html' %}
{% load static %}
{% block head %}
<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
<meta charset='utf-8' />
   <title>Reserve</title>

   <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <style>
     body {
     margin: 0;
     padding-top: 70px;
     color:black;
    }
    .alert{
      position: absolute;
      top: 70px;
      left: 10px;
      z-index: 99;
      right:10px;
    }
    #map {
       position: absolute;
       top: 0;
       bottom: 0;
       width: 100%;
       z-index:1;
    }
   .footer{
     height:80px;
     background-color:#3d3a3a;
     z-index: 5;
     position: absolute;
     bottom: 0;
     width: 100%;
     margin: 0 auto;
     display: none;
     padding:15px;
     display:none;
     border-top-left-radius:5px;
     border-top-right-radius:5px;
   }
   .footer-4{
     height:100%;
     width:100%;
     background-color:#3d3a3a;
     display:flex;
   }
   * {
   box-sizing: border-box
   }


   .gm-style-iw {
    width: 200px !important;
    top: 15px !important;
    left: 0px !important;
    background-color: #3d3a3a !important;
    color:white;
    box-shadow: 0 1px 6px rgba(178, 178, 178, 0.6);
    border: 1px solid rgba(72, 181, 233, 0.6);
    border-radius: 2px 2px 10px 10px;
   }
   #iw-container {
    margin-bottom: 10px;
   }
   #iw-container .iw-title {
    font-family: 'Open Sans Condensed', sans-serif;
    font-size: 22px;
    font-weight: 400;
    padding: 10px;
    background-color: #3dcacd;
    color: white;
    margin: 0;
    border-radius: 2px 2px 0 0;
   }
   #iw-container .iw-content {
    font-size: 13px;
    line-height: 18px;
    font-weight: 400;
    margin-right: 1px;
    padding: 15px 5px 20px 15px;
    max-height: 140px;
    overflow-y: auto;
    overflow-x: hidden;
   }
   .iw-content img {
    float: right;
    margin: 0 5px 5px 10px;
   }
   .iw-subTitle {
    font-size: 16px;
    font-weight: 700;
    padding: 5px 0;
   }
   .iw-bottom-gradient {
    position: absolute;
    width: 326px;
    height: 25px;
    bottom: 10px;
    right: 18px;
    background: linear-gradient(to bottom, rgba(255,255,255,0) 0%, rgba(255,255,255,1) 100%);
    background: -webkit-linear-gradient(top, rgba(255,255,255,0) 0%, rgba(255,255,255,1) 100%);
    background: -moz-linear-gradient(top, rgba(255,255,255,0) 0%, rgba(255,255,255,1) 100%);
    background: -ms-linear-gradient(top, rgba(255,255,255,0) 0%, rgba(255,255,255,1) 100%);
   }
   ::-webkit-scrollbar{
    display:none;
}
   .directionButton {
   background-color: #3dcacd;
   display: block;
   width: 100%;
   height:100%;
   float:left;
   border-radius:12px;
   font-size:15px;
   font-weight:bold;
   border: 2px solid grey;
   -webkit-transition-duration: 0.4s; /* Safari */
   transition-duration: 0.4s;
   }
   .directionButton:hover {
     background-color:  #3d3a3a; /* Green */
     color: #3dcacd;
   }
   .closedirection{
   width:5%;
   height:100%;
   float:left;
   }
   .location {
     width: 40px;
     height: 40px;
     background-color: #3dcacd;
     border-radius: 45%;
     box-shadow: 0 6px 10px 0 #666;
     transition: all 0.1s ease-in-out;
     font-size: 50px;
     color: white;
     text-align: center;
     line-height: 35px;
     position: fixed;
     right: 20px;
     bottom: 20px;
     z-index:5;
   }
   .location:hover {
     box-shadow: 0 6px 14px 0 #666;
     transform: scale(1.05);
   }
   .mapinfo {
     width: 100px;
     height: 35px;
     border-radius: 6px;
     background-color: #3dcacd;
     box-shadow: 0 6px 10px 0 #666;
     transition: all 0.1s ease-in-out;
     font-size: 12px;
     color:  black;
     text-align: left;
     padding-left:4px;
     position: fixed;
     left: 15px;
     bottom: 20px;
     z-index:3;
   }

   .bod,.dia,.modal-content
   {
     background-color: lightgrey;
     color: #3dcacd;
     border-radius:5px;
   }
   .tit{
     font-size: 15px;
     font-weight:bold;
     border-bottom:2px solid;
     border-top:2px solid;
     margin-bottom:4px;
   }
   .modal-content{
     display:flex;
     -moz-box-shadow:    0px 0px 4px 3px #3dcacd;
  -webkit-box-shadow: 0px 0px 4px 3px #3dcacd;
  box-shadow:         0px 0px 4px 3px #3dcacd;
   }
   .column-4, .column-8 {
     float: left;
     position: relative;

   }

   .location1 {
     width: 45%;
     height: 40px;
     border-radius: 10%;
     box-shadow: 0 6px 10px 0 #666;
     transition: all 0.1s ease-in-out;

     text-align: center;
     position: fixed;
     left: 120px;
     bottom: 20px;
     z-index:5;
   }
   .column-4 {
     width: 36%;
     border-right:   solid;
     border-radius:10px;
   }
   .column-8 {
     width: 70%;
     text-align:right;

   }
   .column-1 {
     height: 20%;
     width:100%;
     float: left;
     position: relative;
   }
   .col1 {
     height: 80%;
     float: left;
     width:20%;
     position: relative;
   }
   .col2 {
     height: 50%;
     width:70%;
     float: right;
     position: relative;
   }
   .column-2 {
     width:100%;
     height: 80%;
     float: right;
     position: relative;
   }
   .start,.end{
     border:1px solid;
     text-align:center;
     border-radius:5px;
     font-size:12px;
   }
   .start{
     border:1px solid #7CFC00;
     color: #7CFC00;
     margin-bottom:2px;
   }
   .end{
     border:1px solid #f44336;
     color: #f44336;
     border-color:red;
   }
   .priority{
     font-size:10px;
   }
   .list-group-item{
     background-color: lightgrey;
     border-style:none!important;
     color:black;
   }
   .information
   {
     font-weight:bold;
     font-size:12px;
   }
   .styled-select select {
   background: transparent;
   border: none;
   font-size: 14px;
   height: 29px;
   padding: 15px; /* If you add too much padding here, the options won't show in IE */
   width: 268px;
   }
   .num1{
     background-color:white;
     position:relative;
   }
   .col3{
     font-size:15px;
     font-weight:bold;
     float:right;
     width:70%;
     height:50%;
     position: relative;
   }
   .cont{
     display:block;
   }
   .titles{
     font-size:20px;
     font-weight:bold;
   }
   .costq,.costm,.av,.qu{
    border: 1px solid #3dcacd;
    padding:2px;
    border-radius:4px;
     height:100%;
     width:50%;
     float:left;
   }
   .context{
     font-size:15px;
   }
   .costi{
    font-size:10px;
    padding:4px;
   }
   .rounded {
   -webkit-border-radius: 15px;
   -moz-border-radius: 15px;
   border-radius: 15px;
   }
   .time{
   text-align:center;
   }
   .bike{
   color: #3dcacd;
   text-align:left;
   font-size:15px;
   }
   .black   { background-color: #3dcacd; }
   #myTab a, a:active, a:visited{border:1px solid white;color: white; background-color: #3dcacd;}
   #myTab a:hover {color: darkgrey;   background-color: white;border:1px solid   #3dcacd;
     border-radius:3px; }
   #myTab a:focus{ color:  #3d3a3a; background-color: #3dcacd;border:1px solid  #AFABAA;
     border-radius:3px; }
     .links{
       color:  #3d3a3a;
       background-color: #3dcacd
       ;border:1px solid  #AFABAA;
       border-radius:3px;box-shadow: 2px 2px 1px grey;
     }
     .button-3 {border-radius: 8px; color:  #3d3a3a; background-color: #3dcacd; margin-left:2px;}

     </style>

    {% endblock %}
    {% block body %}

       <!--Ed-->
<div>

   <div id='map'> </div>

 <div id='right-panel' style=" width: auto;  overflow: scroll; height: 75px; line-height: 30px;   font-size: 18px;  padding-right: 10px;
       padding-left: 10px;  width: auto; margin-right: 30px; margin-left: 30px; margin-top: 50px">

     </div>

 <div>
    <button id="modalButton" type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal"></button>

      <!--Ed-->
<button class="btn  btn-danger location1" id='cross' onclick="cross()">Cancel Selection</button>
    <div class="location" onclick="myloc()">

      <img width="20px" height="20px" src="{% static 'icons/location.png' %}"  >
    </div>



    <div class="footer">
      <div class="footer-4">

        <!-- Ed -->
        <select  id="optn" class="directionButton">
           <option value="DRIVING">Driving</option>
          <option value="BICYCLING">Bicycling</option>
        </select>

        <button type="button" style="float:right;opacity:9; color:#3dcacd;" class="close closedirection" onclick="reload_page()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
    </div>
  </div>
    <div class="mapinfo">
      <img style="text-align=right;" src="{% static 'icons/line.png' %}">
      Trails
      <br>
      <img style="text-align=right;" src="{% static 'icons/dotted.png' %}">
      Bike Lanes
    </div>
    <div class="modal fade" id="exampleModal" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog dia" role="document">
        <div class="modal-content">
          <div class="modal-header header column-4" style="border-radius: 0px;background-color: #3d3a3a; ">
            <button type="button" style="float:left;opacity:9; color:#3dcacd;" onclick="reset()" id="clickme" class="close" data-dismiss="modal">
              <span aria-hidden="true">&times;</span>
            </button>
            <br>
            <h5 class="modal-title tit" id="exampleModalLabel" style="font-size: 17px; " >Reservation Details</h5>
            <div style="margin-top: 1%;">

              Start Station <br><div class="start" id="startloc" style="height: 20%; font-size: 17px;" ></div>
              End Station <br><div class="end" id="endloc"  style="height: 20%; font-size: 17px;" ></div><br>
              <p class="information" style="font-size: 17px; text-decoration: none;" id="startinfo"></p>
              <p class="information" id="endinfo" style="font-size: 17px; text-decoration: none;"></p>




            </div>
            <br>
            <table style="width:100%;">
              <tr style="border-bottom: 2px solid; ">
                <th>Calculated Cost</th>
              </tr>
              <tr>
                <td style="border-bottom:1px solid;width:10%;">Time €<span style="text-align:left;" id="cost">0</span></td>
              </tr>
              <tr>
                <td style="border-bottom:1px solid;">Bike&nbsp;&nbsp;&nbsp;€<span style="text-align:left;" id="cyclecost">0</span></td>
              </tr>
              <tr>
                <td>Total  €<span style="text-align:left;" id="totalcost">0</span></td>
              </tr>
            </table>
              <ul class="nav nav-tabs nav-justified"  id="myTab" role="tablist">
                <li class="nav-item" style="text-align:center; width: 100%;">
                  <a onclick="resetHomeSelect()" class="nav-link active" style="width: 100%;" id="home-tab" data-toggle="tab" href="#home1" role="tab" aria-controls="home1" aria-selected="true">Time</a>
                </li>
                <li class="nav-item">
                  <a onclick="resetBikeSelect()" class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false" style="display:none;">Bike</a>
                </li>
              </ul>
          </div>
          <div class="modal-body bod column-8" >
            <div class="tab-content" id="myTabContent">
              <div class="tab-pane fade" id="home1" role="tabpanel" aria-labelledby="home-tab">
                <ul class="list-group" style="color: #3dcacd;">
                  <li class="list-group-item time" style="color: #3d3a3a;font-size: 20px;">
                  <u>  Select reservation time</u>
                  <br>
               <p style="font-size:15px;"> The tarif is <span style="color:#3dcacd;">€5/15min</span> for all bike types</p>

                  </li>

                   <li class="list-group-item time"  style="color: #3d3a3a;">
                      Start Date:
                     <select class="styled-select "  style="width: 80%;"id="select_start_date">
                     <option disabled selected value>Select Start Date</option>
                   </select>
                   </li>
                   <li class="list-group-item time"  style="color: #3d3a3a;">
                    End Date:
                     <select class="styled-select " style="width: 80%;" id="select_end_date">
                       <option disabled selected value>Select End Date</option>
                     </select>
                   </li>
                   <li class="list-group-item time"  style="color: #3d3a3a;">
                    Start Time:
                     <select class="styled-select " style="width: 80%;" id="select_start_time">
                       <option disabled selected value>Select Start Time</option>
                     </select>
                   </li>
                   <li class="list-group-item time"  style="color: #3d3a3a;">
                    End Time:
                     <select class="styled-select " style="width: 80%;" id="select_end_time">
                       <option disabled selected value>Select End Time</option>
                     </select>

                   </li>
                   <li class="list-group-item">
                     <center><p id="displayavailable">Available bikes: <br>Tandem: <span id='type2' style="color:#3dcacd;">1</span> , <br>Mountain: <span id='type1' style="color:#3dcacd;">2</span>, <br>Road: <span id='type3' style="color:#3dcacd;">3</span>, <br>Wheelchair: <span id='type4' style="color:#3dcacd;">0</span></p></center>
                   </li>
                   <li class="list-group-item" >
                     <form action="/home/reserve/" method="POST" name="time-form" id="timeform">
                          <button id="confirm" onclick="bikeSelect()" type="submit" style="color: black; width: 90%; margin-left: 5%;" class="btn btn-success btn-md">
                            <span>Confirm details</span>
                          </button>
                       </form>
                   </li>
                   <li class="list-group-item time">
                     <button onclick="resetSelect()" type="button" class="btn btn-default btn-md" style="width:90%;">
                       <span >Reset</span>
                     </button>


                   </li>
                 </ul>
              </div>              <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                <div>
                  <ul class="list-group">
                    <li class="list-group-item time" id="here"style="color: #3d3a3a;font-size: 20px; text-decoration: none;">
                     <u> Select your bike prefrence</u>
                    </li>

                    <li class="list-group-item">
                      <div style="display: inline-block; width: 100%; height: 100%;">
                        <div style="height:90%;float: left;">
                          <button onclick="resetSelectBike()" type="button" class="btn btn-default">
                            <span >Reset</span>
                          </button>
                        </div>
                        <div style="float: right;">
                      <form style="" action="/home/reserve/" method="POST" name="bike-form" id="bikeform">
                        <button id="confirm2" onclick="timeSelect()" type="submit"  style="background-color:#4CAF50;border-color:#4CAF50; color: black; margin-top: 2%;" class="btn btn-primary btn-md">
                          <span>Confirm</span>
                        </button>
                      </form>
                </div></div>
                    </li>
                    {% for bike in bike_type %}
                    <li class="list-group-item bike" style="margin-left: 5%;margin-bottom: 0%; margin-top: 0%; padding-bottom: 0%;">
                        <div class="row" style="display:inline-block; width: 100%;">
                            <div class="column-1"  style=" border-top: solid 1px white;float:left; background-color: #3d3a3a; border-top-right-radius: 5px; border-top-left-radius: 5px;">
                              <div >
                                  <span id="bike{{ bike.bike_type_id }}" style="  color: white; font-size: 17px; margin-left:2%;"> {{ bike.bike_type }}</span>
                              </div>

                              <div style=" float:right; margin-right: 2%; color: #3d3a3a; margin-left:2%;">

                                <button class="btn btn-success btn-md" style="margin-bottom: 2px;" onclick="removeBike('bike{{ bike.bike_type_id }}')">-</button>
                                <button class="btn btn-success btn-md" style="border-radius: 8px; margin-bottom: 2px; margin-left:2px;" onclick="addBike('bike{{ bike.bike_type_id }}')">+</button>

                              </div>
                            </div>
                            <div class="column-2"  style="color: #3d3a3a; border ;border-bottom-right-radius: 5px;  border-bottom-right-radius: 5px;">
                              <table class="table" style="background-color: white; ">
                                <tr>
                                  <td>
                                    <div class="av" style="border:none;">Available: <br><span style="color:#3dcacd;" id="available{{ bike.bike_type_id }}">{{ maxbikes }}</span></div>
                                  </td>
                                   <td>
                                    <div class="qu"  style="border:none;">Yours:<br> <span style="color:#3dcacd;" id="quantity{{ bike.bike_type_id }}">0</span></div>

                                  </td>

                                </tr>
                                <tr>

                                   <td>
                                     <div class="costm"  style="border:none;">Bike: <br>€<span  style="color:#3dcacd;"id="costperfifteen{{ bike.bike_type_id }}">{{ bike.bike_cost }}</span><br>/15min </div>
                                  </td>
                                  <td>
                                     <div class="costq"  style="border:none;">Rental: <br>€<span style="color:#3dcacd;" id="quantitycost{{ bike.bike_type_id }}">0</span><br>/15min </div>
                                  </td>
                                </tr>
                                <tr>
                                  <div id='modalBike{{ bike.bike_type_id }}' class='bikeInformation' style="background-color:white"  > <!-- #3d3a3a;-->
                                  <div class='bikeInfo' style="color: #3d3a3a; padding-left: 2%; padding-bottom: 2%;padding-top: 2%;  ">
                                      <button type="button btn-success" style='color:black;float:right;border-radius:10px; background-color: #3dcacd;' onclick="displayBikeInfoClose('bike{{ bike.bike_type_id }}')">
                                      <span aria-hidden="true">&times;</span>
                                    </button>

                                    <img style=" margin-top: 2%; margin-right:2%;float:left;width:90px;height:90px;-webkit-filter: drop-shadow(1px 1px 0 black)
      drop-shadow(-1px -1px 0 white);
      filter: drop-shadow(1px 1px 0 white)
              drop-shadow(-1px -1px 0 white);" src="{% static 'bikes/'|add:bike.bike_image %}">
              <h4 style="font-size: 15px; margin-top: 2%;">Model: {{ bike.bike_model }}</h4>

                                    <p style="font-size: 15px;">{{ bike.bike_info }}</p>
                                    <br><u style="font-size: 15px; color: #3dcacd;margin-right: 2%;">Cost per fifteen minutes: {{ bike.bike_cost }}</u>

                                </div>
                                </div>
                                </tr><tr>
                                <button type="button" class="btn-info" style="width: 100%;box-shadow: none; " id="button{{ bike.bike_type_id }}" onclick="displayBikeInfo('bike{{ bike.bike_type_id }}')">Learn more</button>
                               </tr>

                              </table>


                            </div>
                        </div>
                    </li>
                    {% endfor %}

                  </ul>

                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Button trigger modal -->
    <button id="modalButton1" type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal1">
    </button>

    <!-- Modal -->
    <div class="modal fade" id="exampleModal1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content cont" style="color:#3d3a3a;">

          <div class="modal-body context">
            <h5 class="modal-title titles " id="exampleModalLabel1" style="text-align: center; color:#3d3a3a;margin-top: 3%;  font-size:17; ">Would you like to confirm the following reservation?</h5>

            <table style="margin-top: 5%; border: solid 1px white; background-color:lightgrey;border-radius: 10px; width: 100%;">
              <tr >
                <td style="width:50%;">
                   <div class="list-group-item" style="background-color: lightgrey;" >Start Station <br><span  style="font-size: 22px; color: #3dcacd; width: 100%; border-color: #3dcacd;" id="starts"></span></div>

                </td>
                <td style="width:50%;">
                   <div class="list-group-item"style="background-color: lightgrey;" >End Station <br> <span  style="font-size: 22px;  color: #3dcacd; width:100%;border-color: #3dcacd;"  id="ends"></span></div>
               </td>


              </tr>
              <tr>
                 <td style="width:50%;">
                   <div class="list-group-item" style="background-color:lightgrey;" >Your reservation will start at<br> <span style="color:#3dcacd;" id="starting"></span><div>

                 </td>
                 <td style="width:50%;">
                   <div class="list-group-item" style="background-color: lightgrey;">Your reservation will end at <br><span style="color:#3dcacd;" id="ending"></span></div>

                 </td>
              </tr>
              <tr>
                  <td >
                    <div class="list-group-item"style="background-color:lightgrey;"  id="biked" >Bikes reserved:<br></div>
                </td>
                  <td>
                    <table>
                      <tr>
                    <td> <div class="list-group-item" style="background-color: lightgrey;" >Total Hourly cost</div></td><td> €<span id="hourly"></span></td>
                   </tr>
                    <tr><td>
                      <div class="list-group-item"  style="background-color: lightgrey;">Total Bike selected cost</div></td><td> €<span  id="bikebased"></span></td>
                    </tr>
                    <tr>
                      <td>
                      <div class="list-group-item"  style="background-color:lightgrey;" >Final Total cost to pay </div></td><td> €<span  id="finaltotal"></span></td>
                      </tr>
               </table>
                  </td>
              </tr>

            </table>

            <div class="list-group-item"  ><h4>In order to avoid fines, kindly arrive at the station in time to unlock your bike.</h4> <h4>Note that you may edit your reservaation up until 1 hour to that start time of the reservation.</h4></div>
            <form  method="post" name="myform">
              {% csrf_token %}
              <input type="hidden" name="inputendstation" id="inputendstation" value=""/>
              <input type="hidden" name="inputstartstation" id="inputstartstation" value=""/>
              <input type="hidden" name="inputstarttime" id="inputstarttime" value=""/>
              <input type="hidden" name="inputendtime" id="inputendtime" value=""/>
              <input type="hidden" name="inputenddate" id="inputenddate" value=""/>
              <input type="hidden" name="inputstartdate" id="inputstartdate" value=""/>
              <input type="hidden" name="inputtotal" id="inputtotal" value=""/>
              {% for bike in bike_type %}
              <input type="hidden" name="inputbike{{ bike.bike_type_id }}" id="inputbike{{ bike.bike_type_id }}" value="">
              {% endfor %}
              <button type="submit" onclick="send()" style=" width: 100%;"class="btn btn-success">Proceed to Pay</button>
            </form>
          </div>
        </div>
      </div>
    </div>
    <!--This script tags covers the map and the opening of the dialog box-->
    <script>
      $(".closedirection").click(function(){
          $(".footer").slideUp(); });
      $(".location").click(function(){
          $(".footer").slideDown(); });
      document.getElementById('modalButton').style.display="none";
      document.getElementById('modalButton1').style.display="none";
      document.getElementById("confirm2").style.display="none";
      document.getElementById("home-tab").style.display="none";
      document.getElementById("right-panel").style.display="none";
  document.getElementById("cross").style.display="none";
 document.getElementById("displayavailable").style.display="none";
      var x = 0;
      var startlocationid;
      var endlocationid;
      var startlocationname;
      var endlocationname;
      var map;
      var markerlist=[];
      var i=0;
      const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun","Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
      var startTime;
      var endTime;
      var startDate;
      var endDate;
      var bike = {}
        {% for bike in bike_type %}
              bike[{{ bike.bike_type_id }}] = 0;
              document.getElementById("modalBike"+{{bike.bike_type_id}}).style.display="none";
        {% endfor %}
      var bikesselected=false;
      var timesselected=false;
      var repeat = false;
      var done=0;
      var pos ;
      var des;

      // Initialize and add the map
//--------------------------------------------------------------------
      function initMap() {
     var directionsService = new google.maps.DirectionsService;
 var directionsDisplay = new google.maps.DirectionsRenderer;
      // The map, centered at Edinburgh
        map = new google.maps.Map(document.getElementById('map'), {
                center: {lat:55.94136542,lng:-3.18470478},
                zoom: 12,
                zoomControl: false,
                streetViewControl:false,
                styles:
                [
                  {
                    "featureType": 'poi',
                    "stylers": [{"visibility": 'off'}]
                  },
                  {
                      "featureType": "all",
                      "elementType": "all",
                      "stylers": [
                          {
                              "hue": "#ff0000"
                          },
                          {
                              "saturation": -100
                          },
                          {
                              "lightness": -30
                          }
                      ]
                  },
                  {
                      "featureType": "all",
                      "elementType": "labels.text.fill",
                      "stylers": [
                          {
                              "color": "#ffffff"
                          }
                      ]
                  },
                  {
                      "featureType": "all",
                      "elementType": "labels.text.stroke",
                      "stylers": [
                          {
                              "color": "#353535"
                          }
                      ]
                  },
                ]
              });
              var bikeLayer = new google.maps.BicyclingLayer();
              bikeLayer.setMap(map);
              var allowedBounds = new google.maps.LatLngBounds(
              		new google.maps.LatLng(55.87194684844871,-3.4801332165092163),
                  new google.maps.LatLng(56.042897365961046,-2.918450843462324));
              // Define the rectangle and set its editable property to true.
              google.maps.event.addListener(map, 'dragend', function() {
                  if (allowedBounds.contains(map.getCenter())) return;
                  // Out of bounds - Move the map back within the bounds
                  var c = map.getCenter(),
                      x = c.lng(),
                      y = c.lat(),
                      maxX = allowedBounds.getNorthEast().lng(),
                      maxY = allowedBounds.getNorthEast().lat(),
                      minX = allowedBounds.getSouthWest().lng(),
                      minY = allowedBounds.getSouthWest().lat();
                  if (x < minX) x = minX;
                  if (x > maxX) x = maxX;
                  if (y < minY) y = minY;
                  if (y > maxY) y = maxY;
                  map.setCenter(new google.maps.LatLng(y, x));
                });
      // The marker, positioned at Uluru
      var geojson = [
      {% for stat in station %}
          {% if not forloop.first %},{% endif %}
          {
              station_id: "{{ stat.station_id }}",
              address: "{{ stat.address }}",
              lat: "{{ stat.lat }}",
              lon: "{{ stat.lon }}",
              name: "{{ stat.name }}",
              images: "{{ stat.image }}",
              info: "{{ stat.info }}",
              is_active: "{{ stat.is_active }}",
              fine_cost: "{{ stat.fine_cost }}",
              fine_desc: "{{ stat.fine_desc }}"
          }
      {% endfor %}
      ];
      infoWindow = new google.maps.InfoWindow;
      var prev_infowindow=false;
      var prev_window;
      // The marker, positioned at Uluru
      geojson.forEach(function(marker1) {
        if(marker1.is_active==1)
        {
          var url_mask = "{% static 'stations/12345' %}".replace(/12345/, marker1.images);
          var contentString ='<div id="iw-container">' +
                            '<div class="iw-title">'+marker1.name+'</div>' +
                            '<div class="iw-content">' +
                              '<div class="iw-subTitle">'+marker1.address+'</div>' +
                              '<img src='+url_mask+' alt='+marker1.name+' height="115" width="83">' +
                              '<p>'+marker1.info+'</p>'  +
                            '</div>' +
                            '<div class="iw-bottom-gradient"></div>' +
                          '</div>';
          var infowindow = new google.maps.InfoWindow({
                  content: contentString,
                  maxWidth: 350
                });
        google.maps.event.addListener(infowindow, 'domready', function() {

             // Reference to the DIV that wraps the bottom of infowindow
             var iwOuter = $('.gm-style-iw');

             /* Since this div is in a position prior to .gm-div style-iw.
              * We use jQuery and create a iwBackground variable,
              * and took advantage of the existing reference .gm-style-iw for the previous div with .prev().
             */
             var iwBackground = iwOuter.prev();

             // Removes background shadow DIV
             iwBackground.children(':nth-child(2)').css({'display' : 'none'});

             // Removes white background DIV
             iwBackground.children(':nth-child(4)').css({'display' : 'none'});

             // Moves the infowindow 115px to the right.


             // Moves the shadow of the arrow 76px to the left margin.
             iwBackground.children(':nth-child(1)').attr('style', function(i,s){ return s + 'left: 76px !important;'});

             // Moves the arrow 76px to the left margin.
             iwBackground.children(':nth-child(3)').attr('style', function(i,s){ return s + 'left: 76px !important;'});

             // Changes the desired tail shadow color.
             iwBackground.children(':nth-child(3)').find('div').children().css({'box-shadow': 'rgba(72, 181, 233, 0.6) 0px 1px 6px', 'z-index' : '1','background-color': '#3d3a3a'});

             // Reference to the div that groups the close button elements.
             var iwCloseBtn = iwOuter.next();

             // Apply the desired effect to the close button
             iwCloseBtn.css({ right: '50px', top: '10px',});

             // If the content of infowindow not exceed the set maximum height, then the gradient is removed.
             if($('.iw-content').height() < 140){
               $('.iw-bottom-gradient').css({display: 'none'});
             }

             // The API automatically applies 0.7 opacity to the button after the mouseout event. This function reverses this event to the desired value.
             iwCloseBtn.mouseout(function(){
               $(this).css({opacity: '1'});
             });
        });
        var latln = {lat:parseFloat(marker1.lat),lng:parseFloat(marker1.lon)};
        var Marker = new google.maps.Marker({
            map: map,
            icon: "{% static 'icons/marker.png' %}",
           position: latln
        });
            Marker.addListener('click', function() {
              if( prev_infowindow ) {
                 prev_window.close();
              }
              prev_infowindow=true;
              prev_window = infowindow;
              if(!Marker.open){
                  infowindow.open(map,Marker);
                  Marker.open = true;
              }
              else{
                  infowindow.close();
                  Marker.open = false;
              }
              google.maps.event.addListener(map, 'click', function() {
                  infowindow.close();
                  Marker.open = false;
              });
              //--------------------


        //Current Location
       //  var lat = Marker.getPosition().lat();
     //    var lng = Marker.getPosition().lng();

         des = new google.maps.LatLng(latln);
              window.des = des;


          });
          //var touchtime = 0;
          Marker.addListener('dblclick', () =>
             {
                 if(x==1)
                 {
                   Marker.setIcon("{% static 'icons/red.png' %}");
                   endlocationid=marker1.station_id;
                   endlocationname=marker1.name;
                   document.getElementById("cross").style.display="none";
                   prev_window.close();
                   document.getElementById("modalButton").click();
                 }
                 else{
                   Marker.setIcon("{% static 'icons/green.png' %}");
                   startlocationid=marker1.station_id;
                   startlocationname=marker1.name;
                   document.getElementById("cross").style.display="block";
                 }
                 x=x+1;
             }
          );
          markerlist[i]=Marker;
          i=i+1;
        }
      });
      var opt = { minZoom: 11.5, maxZoom: 15 };
      map.setOptions(opt);
//---------------------------------------------------------
//Directions Service and Display

var bounds = new google.maps.LatLngBounds();
var onChangeHandler = function() {
         calculateAndDisplayRoute(directionsService, directionsDisplay);

       };

 window.addEventListener('click', onChangeHandler);
        document.getElementById('optn').addEventListener('change', onChangeHandler);

      }
//--------------------------------------------------------------------
     $('#exampleModal').on('show.bs.modal', function (event) {
         var modal = $(this)
         modal.find('.tit').text('Make a reservation')
         $('#startloc').text(startlocationname);
         $('#endloc').text(endlocationname);
         document.getElementById("home-tab").click();
     });
//--------------------------------------------------------------------
    function cross(){
      for(var d=0;d<markerlist.length;d++){
        markerlist[d].setIcon("{% static 'icons/marker.png' %}");
      }
      reset();
      document.getElementById("cross").style.display="none";
    }
    function reset() {
        document.getElementById("displayavailable").style.display="none";
      document.getElementById("home-tab").style.display="none";
        startlocationname = "";
        endlocationname="";
        x = 0;
        startlocationid="";
        endlocationid="";
        for(var d=0;d<markerlist.length;d++){
          markerlist[d].setIcon("{% static 'icons/marker.png' %}");
        }
        startTime="";
        endTime="";
        startDate="";
        endDate="";
        $('#startinfo').text("");
        $('#endinfo').text("");
        resetSelect();
        done=0;
        var qun;
        {% for bike in bike_type %}
             bike[{{ bike.bike_type_id }}] = 0;
          {% endfor %}
          {% for bike in bike_type %}
           qun=Number($('#quantity{{bike.bike_type_id }}').text());
            for(var i=0;i<qun;i++)//CHANGE TO AVAILABLE BIKES
            {
              removeBike('bike{{ bike.bike_type_id }}');
            }
          {% endfor %}
        $('#cost').text("0");
        $('#cyclecost').text("0");
        $('#totalcost').text("0");
        bikesselected=false;
        timesselected=false;
    }
//--------------------------------------------------------------------
    function disable(selector) {
      document.getElementById(selector).selectedIndex=0;
      document.getElementById(selector).style.color= "grey" ;
      document.getElementById(selector).disabled = true;
    }
//--------------------------------------------------------------------
    function enable(selector) {
          document.getElementById(selector).selectedIndex=0;
          document.getElementById(selector).style.color= "black" ;
          document.getElementById(selector).disabled = false;
    }
//--------------------------------------------------------------------
    function confirmed()
    {
      $('#exampleModal').fadeOut();
      $("#hourly").text($("#cost").text());
      $("#starts").text($('#startloc').text());
      $("#ends").text($('#endloc').text());
      $("#bikebased").text($("#cyclecost").text());
      $("#finaltotal").text($("#totalcost").text());
      {% for bike in bike_type %}
      if(Number($("#quantity{{ bike.bike_type_id }}").text())!=0){
            $("#biked").append(($("#quantity{{ bike.bike_type_id }}").text())+" of {{ bike.bike_type }}  "+"<br>");}
        {% endfor %}
      $("#ending").text(convertMinutes(endTime)+" on "+endDate);
      $("#starting").text(convertMinutes(startTime)+" on "+startDate);
      document.getElementById("modalButton1").click();
    }
//--------------------------------------------------------------------
    function send()
    {
      document.getElementById("exampleModal1").style.display="none";
      document.getElementById("inputstartstation").value=($('#startloc').text());
      document.getElementById("inputendstation").value=($('#endloc').text());
                          {% for bike in bike_type %}
      document.getElementById("inputbike{{ bike.bike_type_id }}").value=(bike[{{ bike.bike_type_id }}]);
                            {% endfor %}
      document.getElementById("inputstarttime").value=(convertMinutes(startTime));
      document.getElementById("inputendtime").value=(convertMinutes(endTime));
      document.getElementById("inputstartdate").value=(startDate);
      document.getElementById("inputenddate").value=(endDate);
      document.getElementById("inputtotal").value=($('#totalcost').text());
      document.myform.submit();
    }
//--------------------------------------------------------------------
    function removeBike(selector) {
           var num = selector[selector.length -1];
           if(Number($('#quantity'+num).text())>0)
            {
              var cost = {{ costperhour }}/4;
               $('#available'+num).text(Number($('#available'+num).text())+1);
                $('#quantity'+num).text(($('#quantity'+num).text())-1);
                if((Number($('#cost').text()))==0)
                {
                $('#quantitycost'+num).text(((Number($('#quantity'+num).text()))*(Number($('#costperfifteen'+num).text()))));
                $('#cyclecost').text(Number($('#cyclecost').text())-(Number($('#costperfifteen'+num).text())));
                }
                else {
                $('#quantitycost'+num).text(((Number($('#quantity'+num).text()))*((Number($('#costperfifteen'+num).text()))*((Number($('#cost').text()))/cost))));
                $('#cyclecost').text(Number($('#cyclecost').text())-(((Number($('#costperfifteen'+num).text()))*((Number($('#cost').text()))/cost))));
                }
                $('#totalcost').text(Number($('#cyclecost').text())+Number($('#cost').text()));

            }
            if(({% for bike in bike_type %}
                  (Number($('#quantity{{ bike.bike_type_id }}').text()))+
            {% endfor %}0)==0)
            {
              bikesselected=false;
                document.getElementById("confirm2").style.display="none";
            }
    }
//--------------------------------------------------------------------
function displayBikeInfo(selector) {
       var num = selector[selector.length -1];
       document.getElementById("modalBike"+num).style.display="block";
       document.getElementById("button"+num).style.background="grey";
       document.getElementById("button"+num).setAttribute("disabled","disabled");
       document.getElementById("button"+num).style.color="grey";
  //    document.getElementById("id").setAttribute("onclick","displayBikeInfoClose()");
}
function displayBikeInfoClose(selector) {
       var num = selector[selector.length -1];
       document.getElementById("modalBike"+num).style.display="none";
        document.getElementById("button"+num).removeAttribute("disabled");
        document.getElementById("button"+num).style.background="#3dcacd";
        document.getElementById("button"+num).style.color="white";
}
//--------------------------------------------------------------------
    function addBike(selector) {
      var num = selector[selector.length -1];
      if(Number($('#available'+num).text())>0)
       {
         document.getElementById("confirm2").style.display="block";
         var cost = {{ costperhour }}/4;
         $('#available'+num).text(($('#available'+num).text())-1);
         $('#quantity'+num).text(Number($('#quantity'+num).text())+1);
         if((Number($('#cost').text()))==0)
         {
             $('#quantitycost'+num).text(((Number($('#quantity'+num).text()))*(Number($('#costperfifteen'+num).text()))));
             $('#cyclecost').text(Number($('#cyclecost').text())+(Number($('#costperfifteen'+num).text())));
          }
          else {
             $('#quantitycost'+num).text(((Number($('#quantity'+num).text()))*((Number($('#costperfifteen'+num).text()))*((Number($('#cost').text()))/cost))));
             $('#cyclecost').text(Number($('#cyclecost').text())+(((Number($('#costperfifteen'+num).text()))*((Number($('#cost').text()))/cost))));
          }
        $('#totalcost').text(Number($('#cyclecost').text())+Number($('#cost').text()));
          }
    }
//--------------------------------------------------------------------
    //https://stackoverflow.com/questions/32890938/next-7-days-in-drop-down-list
    function formatDate(date) {
              var d = new Date(date),
                      day = '' + d.getDate(),
                      month = '' + (d.getMonth() + 1),
                      year = '' +d.getFullYear();
              if (day.length < 2)
                  day = '0' + day;
              return [day,monthNames[month-1],year].join(' ');
          }

//--------------------------------------------------------------------
    function resetSelectBike()
    {
      var qun;
      {% for bike in bike_type %}
           bike[{{ bike.bike_type_id }}] = 0;
        {% endfor %}
        {% for bike in bike_type %}
         qun=Number($('#quantity{{bike.bike_type_id }}').text());
          for(var i=0;i<qun;i++)//CHANGE TO AVAILABLE BIKES
          {
            removeBike('bike{{ bike.bike_type_id }}');
          }
        {% endfor %}
        $("#totalcost").text($("#totalcost").text()-(Number($("#cyclecost").text())));
        $("#cyclecost").text("0");
    }
//--------------------------------------------------------------------
    function resetSelect(){
      populateDate('#select_start_date','Select Start date',{{ reservationdays }},new Date); // use selector for your select
      disable("select_end_date");
      disable("select_end_time");
      disable("select_start_time");
      document.getElementById("confirm").style.display="none";
      $("#totalcost").text($("#totalcost").text()-(Number($("#cost").text())));
      $("#cost").text("0");
    }
//--------------------------------------------------------------------
    function resetHomeSelect(){
      if(timesselected==true)
      {
        resetSelectBike();
        timesselected = false;
        document.getElementById("home-tab").style.display="none";
      }
      else {
        populateDate('#select_start_date','Select Start date',{{ reservationdays }},new Date); // use selector for your select
        disable("select_end_date");
        disable("select_end_time");
        disable("select_start_time");
         document.getElementById("confirm").style.display="none";
         if(bikesselected==false || (bikesselected== true && repeat==false))
         {
              resetSelectBike();
             $("#cyclecost").text("0");
         }
         else {
           repeat=false;
            $("#totalcost").text($("#totalcost").text()-(Number($("#cost").text())));
            $("#cost").text("0");
         }
      }
    }
//--------------------------------------------------------------------
    function resetBikeSelect(){
        if(timesselected==false)
        {
          $("#totalcost").text($("#totalcost").text()-(Number($("#cost").text())));
            $("#cost").text("0");
        }
        else
        {
          var qun;
          {% for bike in bike_type %}
               bike[{{ bike.bike_type_id }}] = 0;
            {% endfor %}
            {% for bike in bike_type %}
             qun=Number($('#quantity{{bike.bike_type_id }}').text());
              for(var i=0;i<qun;i++)//CHANGE TO AVAILABLE BIKES
              {
                removeBike('bike{{ bike.bike_type_id }}');
              }
            {% endfor %}
          $('#home-tab').text("Go back");
          $('#home-tab').css('display','block');
          $('#home-tab').css('width','100%');
          $('#home-tab').css('color','black');
          $('#home-tab').css('margin-top','5%');
          $('#cyclecost').text("0");
        }
    }
//--------------------------------------------------------------------
    function convertMinutes(i)
    {
      var hours,minutes,ampm,text;
      hours = Math.floor(i / 60);
      minutes = i % 60;
      if (minutes < 10){
          minutes = '0' + minutes; // adding leading zero
        }
      ampm = hours % 24 < 12 ? 'AM' : 'PM';
      hours = hours % 12;
      if (hours === 0){
          hours = 12;
        }
        text=(hours + ':' + minutes + ' ' + ampm);
        return text;
    }
//--------------------------------------------------------------------
    function timeSelect(){

      {% for bike in bike_type %}
          bike[{{ bike.bike_type_id }}]=Number($('#quantity{{ bike.bike_type_id }}').text());
        {% endfor %}
      var total = 0;
      {% for bike in bike_type %}
            total = total+bike[{{ bike.bike_type_id }}];
        {% endfor %}
      if((total)>0)
            bikesselected=true;
      if(bikesselected==true && timesselected==true)
      {
        confirmed();
        return;
      //  alert("Done1");
      }
      repeat=true;
      document.getElementById("home-tab").click();
    }
//--------------------------------------------------------------------
    function bikeSelect() {
      //select all times from all dates that are not full
      startTime=document.getElementById("select_start_time").options[document.getElementById("select_start_time").selectedIndex].value;
      endTime=document.getElementById("select_end_time").options[document.getElementById("select_end_time").selectedIndex].value;
      startDate=document.getElementById("select_start_date").options[document.getElementById("select_start_date").selectedIndex].value;
      endDate=document.getElementById("select_end_date").options[document.getElementById("select_end_date").selectedIndex].value;
      $('#startinfo').text('Start: '+ startDate+' '+convertMinutes(startTime));
      $('#endinfo').text('End: '+ endDate+' '+convertMinutes(endTime));
      timesselected=true;
      if(bikesselected==true && timesselected==true)
      {
        confirmed();
      //  alert('Done2');
      }
    }
//--------------------------------------------------------------------
    function populateDate(selector,text,days,curr)
    {
      var x;
      //book today too unless its 11
      if((curr.getMinutes()+(curr.getHours()*60))>= (1440-60-15) && selector=='#select_start_date')
      {
          x=1;
          days=days+1;
      }
      else if(selector=='#select_end_date' && curr.toDateString() == new Date().toDateString())
      {
        var dates= new Date();
        if((dates.getMinutes()+(dates.getHours()*60))< (1440-60-15)  && (dates.getMinutes()+(dates.getHours()*60))>= (1440-60-15-15))
        {x=1;}
        else{x=0;}
      }
      else
        x=0;
      var options = "";
      var first = curr.getDate();
      var firstday = (new Date(curr.setDate(first))).toString();
      $(selector).empty().append('<option disabled selected value>' +text+ '</option>');
      for (var i = x; i < days; i++) {
          var next = new Date(curr.getTime());
          next.setDate(first + i);
          $(selector).append('<option>' + formatDate((next.toString())) + '</option>');
      }
    }
//--------------------------------------------------------------------
    //https://stackoverflow.com/questions/8918168/javascript-dynamic-time-drop-down
    function populate(selector,text,x,y) {
      //select all times from all dates that are not full
      var select = $(selector);
      var hours, minutes, ampm;
      select.empty().append($('<option disabled selected value>'+text+'</option>'));
      for(var i = x; i <= y; i += 15){
          hours = Math.floor(i / 60);
          minutes = i % 60;
          if (minutes < 10){
              minutes = '0' + minutes; // adding leading zero
            }
          ampm = hours % 24 < 12 ? 'AM' : 'PM';
          hours = hours % 12;
          if (hours === 0){
              hours = 12;
            }
          select.append($('<option></option>')
          .attr('value', i)
          .text(hours + ':' + minutes + ' ' + ampm));
    }
    }


//--------------------------------------------------------------------
    $('#select_start_date').change(function() {
    var parts = $(this).val().split(' ');
    dateselected=new Date(parts[2],monthNames.indexOf(parts[1]),parts[0]);
    populateDate("#select_end_date",'Select End date',2,dateselected);
    enable("select_end_date");
    disable("select_end_time");
    disable("select_start_time");
    document.getElementById("displayavailable").style.display="none";
    $("#totalcost").text($("#totalcost").text()-(Number($("#cost").text())));
    $("#cost").text("0");
    document.getElementById("confirm").style.display="none";
    });

//--------------------------------------------------------------------
    $('#select_end_date').change(function() {
     disable("select_end_time");
     enable("select_start_time");
     var parts = $(this).val().split(' ');
     document.getElementById("displayavailable").style.display="none";
     dateselected=new Date(parts[2],monthNames.indexOf(parts[1]),parts[0]);
     var start=document.getElementById("select_start_date").options[document.getElementById("select_start_date").selectedIndex].value.split(' ');
     var st=new Date(start[2],monthNames.indexOf(start[1]),start[0]);
     var end=document.getElementById("select_end_date").options[document.getElementById("select_end_date").selectedIndex].value.split(' ');
     var en=new Date(end[2],monthNames.indexOf(end[1]),end[0]);
     if(st.toDateString() == new Date().toDateString() && en.toDateString() != new Date().toDateString())
     {
       var dates = new Date();
       if(st.getDate()==(dates.getDate()+1) && (dates.getMinutes()+(dates.getHours()*60)) >= 1380)
         populate('#select_start_time','Select Start time',(((new Date().getMinutes()) + ((15 - ((new Date().getMinutes()) % 15))) % 15))+((new Date().getHours())*60)+60-1440,1425);
       else
        populate('#select_start_time','Select Start time',(((new Date().getMinutes()) + ((15 - ((new Date().getMinutes()) % 15))) % 15))+((new Date().getHours())*60)+60,1425);
     }
     else if(st.toDateString() == new Date().toDateString() && en.toDateString() == new Date().toDateString())
     {
       var dates = new Date();
       if(st.getDate()==(dates.getDate()+1) && (dates.getMinutes()+(dates.getHours()*60)) >= 1380)
         populate('#select_start_time','Select Start time',(((new Date().getMinutes()) + ((15 - ((new Date().getMinutes()) % 15))) % 15))+((new Date().getHours())*60)+60-1440,1425);
       else
        populate('#select_start_time','Select Start time',(((new Date().getMinutes()) + ((15 - ((new Date().getMinutes()) % 15))) % 15))+((new Date().getHours())*60)+60,1410);
     }
     else {
       var dates = new Date();
       if(st.getDate()==(dates.getDate()+1) && (dates.getMinutes()+(dates.getHours()*60)) >= 1380)
         populate('#select_start_time','Select Start time',(((new Date().getMinutes()) + ((15 - ((new Date().getMinutes()) % 15))) % 15))+((new Date().getHours())*60)+60-1440,1425);
       else
        populate('#select_start_time','Select Start time',0,1425);
     }
     $("#totalcost").text($("#totalcost").text()-(Number($("#cost").text())));
     $("#cost").text("0");
     document.getElementById("confirm").style.display="none";
    });

//--------------------------------------------------------------------
    $('#select_start_time').change(function() {
    enable("select_end_time");
    document.getElementById("displayavailable").style.display="none";
    var start=document.getElementById("select_start_date").options[document.getElementById("select_start_date").selectedIndex].value.split(' ');
    var st=new Date(start[2],monthNames.indexOf(start[1]),start[0]);
    var end=document.getElementById("select_end_date").options[document.getElementById("select_end_date").selectedIndex].value.split(' ');
    var en=new Date(end[2],monthNames.indexOf(end[1]),end[0]);
    if(st.toDateString() == en.toDateString())
    {
      populate('#select_end_time','Select End time',Number($(this).val())+15,1425);
    }
    else {
      populate('#select_end_time','Select End time',0,Number($(this).val()));
    }
    $("#totalcost").text($("#totalcost").text()-(Number($("#cost").text())));
      $("#cost").text("0");
    document.getElementById("confirm").style.display="none";
    });

//--------------------------------------------------------------------
    $('#select_end_time').change(function() {
          document.getElementById("confirm").style.display="block";
          var cost=0;
          var costperfifteen={{ costperhour }}/4;
          startTime=document.getElementById("select_start_time").options[document.getElementById("select_start_time").selectedIndex].value;
          endTime=document.getElementById("select_end_time").options[document.getElementById("select_end_time").selectedIndex].value;
          startDate=document.getElementById("select_start_date").options[document.getElementById("select_start_date").selectedIndex].value;
          endDate=document.getElementById("select_end_date").options[document.getElementById("select_end_date").selectedIndex].value;
          event.preventDefault();
          show_post();
          document.getElementById("displayavailable").style.display="block";
          if(startDate==endDate)
          {
              for(var i = Number(startTime); i < Number(endTime); i += 15){
                cost=costperfifteen+cost;
          }
          }
          else {
            for(var i = Number(startTime); i < 1440; i += 15){
                cost=costperfifteen+cost;
              }
          for(var i = 0; i < Number(endTime); i += 15){
              cost=costperfifteen+cost;
            }
          }
          $('#cost').text(Number(cost));
          $('#totalcost').text(Number(cost)+Number($('#cyclecost').text()));
    });

//--------------------------------------------------------------------
    $(document).ready(function(){
   setInterval(function(){ reload_page(); },60*60000);
    });
//--------------------------------------------------------------------
    function reload_page()
    {
      window.location.reload(true);
      document.getElementById("right-panel").style.display="none";

    }
//--------------------------------------------------------------------
    $(function() {
    // This function gets cookie with a given name
    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie != '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = jQuery.trim(cookies[i]);
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) == (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    var csrftoken = getCookie('csrftoken');
    /*
    The functions below will create a header with csrftoken
    */

    function csrfSafeMethod(method) {
        // these HTTP methods do not require CSRF protection
        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
    }
    function sameOrigin(url) {
        // test that a given url is a same-origin URL
        // url could be relative or scheme relative or absolute
        var host = document.location.host; // host + port
        var protocol = document.location.protocol;
        var sr_origin = '//' + host;
        var origin = protocol + sr_origin;
        // Allow absolute or scheme relative URLs to same origin
        return (url == origin || url.slice(0, origin.length + 1) == origin + '/') ||
            (url == sr_origin || url.slice(0, sr_origin.length + 1) == sr_origin + '/') ||
            // or any other URL that isn't scheme relative or absolute i.e relative.
            !(/^(\/\/|http:|https:).*/.test(url));
    }

    $.ajaxSetup({
        beforeSend: function(xhr, settings) {
            if (!csrfSafeMethod(settings.type) && sameOrigin(settings.url)) {
                // Send the token to same-origin, relative URLs only.
                // Send the token only if the method warrants CSRF protection
                // Using the CSRFToken value acquired earlier
                xhr.setRequestHeader("X-CSRFToken", csrftoken);
            }
        }
    });
});
//--------------------------------------------------------------------
    $('#timeform').on('submit', function(event){
    event.preventDefault();
    time_post();
});
//--------------------------------------------------------------------
// AJAX for posting
function time_post() {
    $.ajax({
            url : "/home/reserve/", // the endpoint
            type : "POST", // http method
            data : { formtype : 'time', starttime: convertMinutes(startTime) , endtime: convertMinutes(endTime), startdate: startDate, enddate: endDate,startstation: $('#startloc').text(),endstation:$('#endloc').text()}, // data sent with the post request

            // handle a successful response
            success : function(json) {
              if (
                    //this part checks if all the available bikes added together ==0 if yes then returns 0
                  {% for bike in bike_type %}
                    json.result{{ bike.bike_type_id }} +
                  {% endfor %}0 == 0)
                  {
                    alert("Sorry, there are no bikes available for that timing, try again");
                    document.getElementById("home-tab").click();
                  }
            //This else loop sets the available bikes for each of the bike types
              else{
                {% for bike in bike_type %}
                $('#available{{ bike.bike_type_id }}').text(json.result{{ bike.bike_type_id }}); // remove the value from the input
              {% endfor %}
            document.getElementById("profile-tab").click();
          }
        },
        // handle a non-successful response
        error : function(xhr,errmsg,err) {
                }
    });
};
//--------------------------------------------------------------------
//--------------------------------------------------------------------
// AJAX for posting
function show_post() {
    $.ajax({
            url : "/home/reserve/", // the endpoint
            type : "POST", // http method
            data : { formtype : 'time', starttime: convertMinutes(startTime) , endtime: convertMinutes(endTime), startdate: startDate, enddate: endDate,startstation: $('#startloc').text(),endstation:$('#endloc').text()}, // data sent with the post request

            // handle a successful response
            success : function(json) {

                {% for bike in bike_type %}
               $("#type{{ bike.bike_type_id }}").text(json.result{{ bike.bike_type_id }});
              {% endfor %}
        },
        // handle a non-successful response
        error : function(xhr,errmsg,err) {
                }
    });
};
//--------------------------------------------------------------------
$('#bikeform').on('submit', function(event){
  event.preventDefault();
  bike_post();
});
//--------------------------------------------------------------------
// AJAX for posting
function bike_post() {
    $.ajax({
        url : "/home/reserve/", // the endpoint
        type : "POST", // http method
        data : { formtype: 'bike', bikes: bike}, // data sent with the post fo
        // handle a successful response
        success : function(json) {
            $('#post-text').val(json.result); // remove the value from the input
        },
        // handle a non-successful response
        error : function(xhr,errmsg,err) {
                }
        });
};
//--------------------------------------------------------------------
//Current Location
function myloc(){
 if (navigator.geolocation) {
         navigator.geolocation.watchPosition(function(position) {

           pos = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
 window.pos = pos;
  var loc = new google.maps.Marker({
        position: pos,
         icon: "{% static 'icons/yourloc.png' %}",
         animation: google.maps.Animation.DROP,
         map: map
     });

    infoWindow.setPosition();
    infoWindow.setContent('You are here');

             infoWindow.open(map);
             map.setCenter(pos);
           }, function() {
             handleLocationError(true, infoWindow, map.getCenter());
           });
         } else {
           // Browser doesn't support Geolocation
           handleLocationError(false, infoWindow, map.getCenter());
         }

 }

       function handleLocationError(browserHasGeolocation, infoWindow, pos) {
         infoWindow.setPosition(pos);
         infoWindow.setContent(browserHasGeolocation ?
                               'Error: The Geolocation service failed.' :
                               'Error: Your browser doesn\'t support geolocation.');
         infoWindow.open(map);
       }



//--------------------------------------------------------------------
//Directions

function calculateAndDisplayRoute(directionsService, directionsDisplay) {
//var start = document.getElementById('start').value;
   // var  pos = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
      //  var end = document.getElementById('end').value;

        var optn = document.getElementById('optn').value;
         directionsService.route({
           origin: pos,
           destination: des,
           travelMode: optn,
           drivingOptions: {
     departureTime: new Date(Date.now()),  // for the time N milliseconds from now.
     trafficModel: 'optimistic'
   }
        }, function(response, status) {
           if (status === 'OK') {
             directionsDisplay.setDirections(response);
              // Direction Panel
            document.getElementById("right-panel").style.display="block";
            directionsDisplay.setPanel(document.getElementById('right-panel'));
            document.getElementById('right-panel').style.background="lightgrey";
            document.getElementById('right-panel').style.borderRadius="5px";
            document.getElementById('right-panel').style.border="3px solid grey";
            document.getElementById('right-panel').style.height="100px";
            directionsDisplay.setMap(map);
            bikeLayer.setMap(map);

           } else {
             window.alert('Directions request failed due to ' + status);
          }
         });
       }

//--------------------------------------------------------------------



  </script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBCa-MhtE2n9Sk8pNdkqhLjdw70Jr8fCZ4&callback=initMap">
  </script>
{% endblock %}
